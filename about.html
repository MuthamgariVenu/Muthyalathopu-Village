<!doctype html>
<html lang="te">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>‡∞ó‡±ç‡∞∞‡∞æ‡∞Æ‡∞Ç ‡∞ó‡±Å‡∞∞‡∞ø‡∞Ç‡∞ö‡∞ø ‚Äî ‡∞Æ‡±Å‡∞§‡±ç‡∞Ø‡∞æ‡∞≤‡∞≤‡±ã‡∞™‡±Å</title>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- PapaParse (if you want to load CSVs) -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <style>
    :root{
      --bg: #f8fafc;
      --card: #ffffff;
      --muted: #6b7280;
      --accent: #f97316;
      --text: #0f172a;

      /* BUTTONS (day) */
      --btn-bg: #f3f4f6;
      --btn-text: #0f172a;
      --btn-border: rgba(2,6,23,0.06);

      /* map poly color */
      --poly-stroke: #fb923c;
      --poly-fill: rgba(251,146,60,0.08);
    }

    /* MOON theme */
    .moon{
      --bg: #07102a;
      --card: rgba(255,255,255,0.03);
      --muted: #cbd5e1;
      --accent: #fb923c;
      --text: #e6f0ff;

      --btn-bg: rgba(255,255,255,0.06);  /* visible button bg in dark */
      --btn-text: #e6f0ff;
      --btn-border: rgba(255,255,255,0.06);

      --poly-stroke: #fb923c;
      --poly-fill: rgba(251,146,60,0.06);
    }

    html,body { height:100%; margin:0; font-family: ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Arial; background:var(--bg); color:var(--text); transition:all .16s; }
    header{ position:fixed; top:0; left:0; right:0; z-index:50; background:var(--card); padding:10px 14px; box-shadow:0 2px 6px rgba(2,6,23,0.06);}
    .hdr{ max-width:1100px; margin:0 auto; display:flex; align-items:center; justify-content:space-between; gap:12px; }
    .logo{ width:44px; height:44px; border-radius:8px; object-fit:cover; }
    .title-main{ font-weight:700; font-size:1.05rem; }
    .title-sub{ font-size:0.82rem; color:var(--muted); }

    main{ max-width:1100px; margin:0 auto; padding:76px 14px 36px; }

    .card{ background:var(--card); border-radius:10px; padding:14px; box-shadow:0 1px 4px rgba(2,6,23,0.04); margin-bottom:14px; color:var(--text); }
    .muted{ color:var(--muted); }
    .accent{ color:var(--accent); }

    /* Buttons use variables (ensures dark mode contrast) */
    .btn{
      display:inline-block;
      padding:8px 12px;
      border-radius:8px;
      background:var(--btn-bg);
      color:var(--btn-text);
      border:1px solid var(--btn-border);
      cursor:pointer;
      font-weight:600;
      text-decoration:none;
    }
    .btn:active{ transform:translateY(1px); }

    /* Map container */
    #map { height:420px; width:100%; border-radius:8px; }

    .muted-note{ margin-top:8px; color:var(--muted); font-size:0.92rem; }

    /* small responsive */
    @media(max-width:640px){
      #map{ height:320px; }
      .hdr{ padding:8px 10px; }
    }

  </style>
</head>
<body id="page">

  <header>
    <div class="hdr">
      <div style="display:flex;gap:12px;align-items:center;">
        <a href="index.html"><img src="images/logo.png" class="logo" alt="logo" onerror="this.style.display='none'"></a>
        <div>
          <div class="title-main telugu">‡∞ó‡±ç‡∞∞‡∞æ‡∞Æ‡∞Ç ‡∞ó‡±Å‡∞∞‡∞ø‡∞Ç‡∞ö‡∞ø ‚Äî ‡∞Æ‡±Å‡∞§‡±ç‡∞Ø‡∞æ‡∞≤‡∞≤‡±ã‡∞™‡±Å</div>
          <div class="title-sub telugu">‡∞Æ‡∞æ‡∞™‡±ç & ‡∞∏‡∞∞‡±ç‡∞µ‡±Ä‡∞∏‡±Å‡∞≤‡±Å</div>
        </div>
      </div>

      <div style="display:flex;gap:8px;align-items:center;">
        <a href="index.html" class="btn telugu">‚Üê ‡∞°‡±ç‡∞Ø‡∞æ‡∞∑‡±ç‚Äå‡∞¨‡±ã‡∞∞‡±ç‡∞°‡±ç</a>
        <button id="moonToggle" class="btn" title="‡∞∞‡∞æ‡∞§‡±ç‡∞∞‡∞ø/‡∞™‡∞ó‡∞≤-toggle">üåô</button>
      </div>
    </div>
  </header>

  <main>
    <section class="card">
      <h3 class="font-semibold telugu">‡∞ó‡±ç‡∞∞‡∞æ‡∞Æ ‡∞Æ‡±ç‡∞Ø‡∞æ‡∞™‡±ç (‡∞∏‡∞æ‡∞ü‡∞ø‡∞≤‡±à‡∞ü‡±ç)</h3>
      <div id="map" aria-label="Village map"></div>
      <div class="muted-note telugu">
        ‡∞ú‡∞ø‡∞Ø‡±ã‡∞ê‡∞∏‡±ç‡∞ì‡∞é‡∞®‡±ç (GeoJSON) ‡∞´‡±à‡∞≤‡±ç ‡∞â‡∞Ç‡∞ü‡±á ‡∞ö‡±Ç‡∞™‡∞¨‡∞°‡±Å‡∞§‡±Å‡∞Ç‡∞¶‡∞ø. ‡∞≤‡±á‡∞ï‡∞™‡±ã‡∞§‡±á ‡∞Ö‡∞Ç‡∞¶‡±Å‡∞¨‡∞æ‡∞ü‡±Å‡∞≤‡±ã ‡∞≤‡±á‡∞®‡∞ø ‡∞∏‡∞Ç‡∞¶‡±á‡∞∂‡∞Ç ‡∞µ‡∞∏‡±ç‡∞§‡±Å‡∞Ç‡∞¶‡∞ø.  
        ‚Äî GitHub ‡∞≤‡±ã `Data/muthyalathopu.geojson` ‡∞™‡±Ü‡∞ü‡±ç‡∞ü‡∞ø ‡∞∞‡±Ä-‡∞´‡±ç‡∞∞‡±Ü‡∞∑‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø.
      </div>
    </section>

    <section class="card" id="basicInfo">
      <h3 class="font-semibold telugu">‡∞®‡±Ä‡∞∞‡±Å & ‡∞µ‡∞ø‡∞¶‡±ç‡∞Ø‡±Å‡∞§‡±ç ‡∞∏‡∞Æ‡∞æ‡∞ö‡∞æ‡∞∞‡∞Ç</h3>
      <div class="muted telugu tiny">
        ‡∞¨‡±ã‡∞∞‡±ç‡∞≤‡±Å: 5<br>
        ‡∞®‡±Ä‡∞ü‡∞ø ‡∞∏‡∞∞‡∞´‡∞∞‡∞æ ‡∞∑‡±Ü‡∞°‡±ç‡∞Ø‡±Ç‡∞≤‡±ç: 6:00-8:00 AM<br>
        ‡∞µ‡∞ø‡∞¶‡±ç‡∞Ø‡±Å‡∞§‡±ç ‡∞≤‡±à‡∞®‡±ç / ‡∞â‡∞™‡∞ï‡±á‡∞Ç‡∞¶‡±ç‡∞∞‡∞Æ‡±ç: ‡∞∏‡∞¨‡±ç ‡∞∏‡±ç‡∞ü‡±á‡∞∑‡∞®‡±ç 33/11kV
      </div>
    </section>

    <section class="card">
      <h3 class="font-semibold telugu">‡∞Ö‡∞§‡±ç‡∞Ø‡∞µ‡∞∏‡∞∞ ‡∞∏‡∞π‡∞æ‡∞Ø‡∞Ç & ‡∞π‡±Ü‡∞≤‡±ç‡∞™‡±ç‚Äå‡∞≤‡±à‡∞®‡±ç</h3>
      <ul class="muted telugu" style="margin:8px 0 0 18px;">
        <li>‡∞Ö‡∞Ç‡∞¨‡±Å‡∞≤‡±Ü‡∞®‡±ç‡∞∏‡±ç: <a class="btn link" href="tel:+919812345678">+91 98123 45678</a></li>
        <li>‡∞™‡±ã‡∞≤‡±Ä‡∞∏‡±ç: <a class="btn link" href="tel:+919898765432">+91 98987 65432</a></li>
        <li>VRO: <a class="btn link" href="tel:+919988766554">+91 99887 66554</a></li>
      </ul>
    </section>
  </main>

<script>
/* Theme toggle */
const page = document.getElementById('page');
const moonToggle = document.getElementById('moonToggle');
function applyMoon(v){
  document.documentElement.classList.toggle('moon', v);
  localStorage.setItem('muthya_moon', v ? '1' : '0');
  moonToggle.textContent = v ? 'üåû' : 'üåô';
}
applyMoon(localStorage.getItem('muthya_moon') === '1');
moonToggle.addEventListener('click', ()=> applyMoon(!document.documentElement.classList.contains('moon')));

/* Initialize Leaflet map */
const map = L.map('map', { zoomControl: true, preferCanvas: false });
/* Use Esri satellite tiles (good quality) */
const esriSat = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
  attribution: 'Tiles ¬© Esri', maxZoom: 19
}).addTo(map);

/* Road tiles (optional) */
const osmRoad = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '&copy; OpenStreetMap', maxZoom: 19
});

/* layers control */
const baseMaps = { "Satellite": esriSat, "Road": osmRoad };
L.control.layers(baseMaps, {}, { position: 'topright' }).addTo(map);

/* Default center fallback (coarse; if GeoJSON not present user can place GeoJSON) */
const fallbackCenter = [14.4316, 80.1052]; // approximate coastal Nellore area (replaceable)
map.setView(fallbackCenter, 15);

/* Try load GeoJSON from Data/muthyalathopu.geojson */
async function loadGeoJSON(){
  try{
    const res = await fetch('Data/muthyalathopu.geojson', {cache:"no-store"});
    if(!res.ok) throw new Error('no geojson');
    const geo = await res.json();

    // add to map with style
    const style = {
      color: getComputedStyle(document.documentElement).getPropertyValue('--poly-stroke')?.trim() || '#fb923c',
      weight: 3,
      dashArray: '',
      fillColor: getComputedStyle(document.documentElement).getPropertyValue('--poly-fill')?.trim() || 'rgba(251,146,60,0.08)',
      fillOpacity: 0.2
    };

    const gj = L.geoJSON(geo, {
      style: style,
      onEachFeature: (feat, layer) => {
        let info = '';
        if(feat.properties){
          if(feat.properties.name) info += `<strong>${feat.properties.name}</strong><br/>`;
          for(const k of Object.keys(feat.properties)){
            if(k==='name') continue;
            info += `<small>${k}: ${feat.properties[k]}</small><br/>`;
          }
        }
        if(info) layer.bindPopup(info);
      }
    }).addTo(map);

    // fit to polygon bounds
    try{
      map.fitBounds(gj.getBounds(), { padding: [30,30] });
    }catch(e){
      // fallback - set to predefined zoom
      map.setView(fallbackCenter, 15);
    }
  }catch(err){
    // No geojson found ‚Äî show marker and message
    console.warn('GeoJSON not found or failed to load:', err);
    // show small sample polygon (non-authoritative) centered near fallback center
    const samplePoly = [
      [14.4332, 80.1028],
      [14.4346, 80.1090],
      [14.4302, 80.1112],
      [14.4288, 80.1060],
      [14.4316, 80.1020]
    ];
    const poly = L.polygon(samplePoly, { color: getComputedStyle(document.documentElement).getPropertyValue('--poly-stroke') || '#fb923c', weight:3, fillColor: getComputedStyle(document.documentElement).getPropertyValue('--poly-fill') || 'rgba(251,146,60,0.08)', fillOpacity:0.12 }).addTo(map);
    map.setView(fallbackCenter, 15);

    // also show a popup/instruction overlay
    const msg = `‡∞∏‡∞∞‡±à‡∞® GeoJSON ‡∞´‡±à‡∞≤‡±ç ‡∞ï‡∞®‡∞¨‡∞°‡∞≤‡±á‡∞¶‡±Å. ‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø GitHub repository ‡∞≤‡±ã \`Data/muthyalathopu.geojson\` ‡∞Ö‡∞™‡±ç‡∞≤‡±ã‡∞°‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø (GeoJSON polygon/boundary). ‡∞ï‡∞Ç‡∞ü‡±á ‡∞Ü ‡∞∏‡∞Æ‡∞Ø‡∞Ç‡∞≤‡±ã ‡∞Æ‡±Ä‡∞ï‡±Å ‡∞ñ‡∞ö‡±ç‡∞ö‡∞ø‡∞§‡∞Æ‡±à‡∞® ‡∞ó‡±ç‡∞∞‡∞æ‡∞Æ ‡∞¨‡±å‡∞Ç‡∞°‡∞∞‡±Ä ‡∞ï‡∞®‡∞ø‡∞™‡∞ø‡∞∏‡±ç‡∞§‡±Å‡∞Ç‡∞¶‡∞ø.`;
    setTimeout(()=>{ poly.bindPopup(msg).openPopup(); }, 700);
  }
}

/* load on init */
loadGeoJSON();

</script>
</body>
</html>
