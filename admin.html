<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Village Admin Dashboard (Sample)</title>
  <style>
    :root{--bg:#f7fafc;--card:#fff;--accent:#0f6;--muted:#6b7280}
    html,body{height:100%;margin:0;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial}
    body{background:var(--bg);color:#111}
    .app{display:flex;flex-direction:column;min-height:100vh}
    header{background:#0b4; padding:14px 18px;color:#032;display:flex;align-items:center;gap:12px}
    header h1{font-size:18px;margin:0}
    main{flex:1;display:flex;gap:12px;padding:12px}
    .panel{background:var(--card);border-radius:10px;box-shadow:0 1px 4px rgba(2,6,23,0.06);padding:12px}
    .left{width:320px;min-width:220px}
    .center{flex:1}
    .right{width:360px;min-width:240px}
    .vlist{max-height:72vh;overflow:auto}
    .vitem{padding:10px;border-radius:8px;display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;border:1px solid #eee}
    .vitem button{background:transparent;border:0;padding:6px 8px;border-radius:6px;cursor:pointer}
    .counts{display:flex;gap:8px;flex-wrap:wrap;margin-top:6px}
    .chip{background:#eef; padding:6px 8px;border-radius:8px;font-size:13px}
    h2{font-size:16px;margin:8px 0}
    table{width:100%;border-collapse:collapse}
    table th, table td{padding:6px;border-bottom:1px solid #f1f1f1;text-align:left;font-size:13px}
    .btn{background:#0b8457;color:white;border:0;padding:8px 12px;border-radius:8px;cursor:pointer}
    .muted{color:var(--muted);font-size:13px}
    .small{font-size:13px}
    .family-tree{padding-left:8px;border-left:2px dashed #eee;margin-top:8px}
    .controls{display:flex;gap:8px;flex-wrap:wrap}
    @media(max-width:900px){main{flex-direction:column}.left,.right{width:100%}}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>Village Admin — Sample Dashboard</h1>
      <div class="muted">(sample data generator + CSV export)</div>
    </header>

    <main>
      <aside class="panel left">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <strong>Villages</strong>
            <div class="muted small">Click a village to view heads and families</div>
          </div>
          <div>
            <button class="btn" id="regen">Generate 100 villages</button>
          </div>
        </div>

        <div style="margin-top:10px;display:flex;gap:8px;align-items:center;flex-wrap:wrap">
          <div class="chip" id="totalVillages">Villages: 0</div>
          <div class="chip" id="totalPeople">Total People: 0</div>
          <button id="downloadCsv" class="btn">Download CSV</button>
        </div>

        <div class="vlist" id="villageList" style="margin-top:12px"></div>
      </aside>

      <section class="panel center">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <h2 id="selVillageTitle">Select a village</h2>
            <div id="selVillageSub" class="muted small">Click any village from left</div>
          </div>
          <div style="display:flex;gap:8px">
            <button class="btn" id="showFunds">Village Funds</button>
            <button class="btn" id="showSchemes">Schemes</button>
          </div>
        </div>

        <div id="headsArea" style="margin-top:12px"></div>

        <div id="familyArea" style="margin-top:12px"></div>
      </section>

      <aside class="panel right">
        <h2>Details</h2>
        <div id="detailArea" class="muted small">Select a village to see details (funds, pending schemes, reasons)</div>

        <div style="margin-top:12px">
          <h3 style="margin:6px 0">Funds summary</h3>
          <div id="fundSummary"></div>
        </div>

        <div style="margin-top:12px">
          <h3 style="margin:6px 0">Pending schemes</h3>
          <div id="pendingSchemes"></div>
        </div>

      </aside>
    </main>
  </div>

  <script>
    // Sample data generator and UI logic
    function randInt(min,max){return Math.floor(Math.random()*(max-min+1))+min}
    function sampleNames(n){
      const names = ["Ramu","Sita","Lakshmi","Venkatesh","Manoj","Radha","Suresh","Kumari","Ravi","Anita","Krishna","Mohan","Shyam","Lakshman","Geeta","Hari","Raja","Seetha","Bala","Reddy","Koteswar","Padma","Uma","Subba","Narayana","Divya","Chandra","Pradeep","Sowmya","Vinod","Latha"]
      let out=[]; for(let i=0;i<n;i++) out.push(names[randInt(0,names.length-1)]+" "+(randInt(1,99)))
      return out
    }

    function generateVillage(index){
      const vName = `Village-${index+1}`
      const numFamilies = randInt(20,80)
      const families = []
      let totalPeople=0
      for(let f=0; f<numFamilies; f++){
        const head = sampleNames(1)[0]
        const famSize = randInt(2,7)
        totalPeople += famSize
        const members = [ {name: head, relation:'Head', age: randInt(30,70)} ]
        for(let m=1;m<famSize;m++) members.push({name: sampleNames(1)[0], relation: ['Spouse','Child','Parent'][randInt(0,2)], age:randInt(1,80)})

        // Schemes per family (some applied, some pending)
        const schemesList = []
        const schemesMaster = ["PMAY","MGNREGA","Pension","Scholarship","Crop Insurance","Awas+","Water+","Sanitation"]
        const appliedCount = randInt(0,3)
        for(let s=0;s<appliedCount;s++){
          const sch = schemesMaster[randInt(0,schemesMaster.length-1)]
          const status = Math.random()<0.6? 'Approved' : 'Pending'
          schemesList.push({name:sch,status:status,reason: status==='Pending' ? ['Docs missing','Incomplete form','Not eligible'][randInt(0,2)] : ''})
        }

        families.push({head, members, schemes:schemesList})
      }
      // Village level funds
      const fundsReceived = randInt(100000,2000000)
      const fundsAllocated = fundsReceived + randInt(0,500000)
      const fundsPending = Math.max(0, fundsAllocated - fundsReceived)
      // Aggregate schemes
      const schemeSummary = {}
      families.forEach(f=>f.schemes.forEach(s=>{ if(!schemeSummary[s.name]) schemeSummary[s.name]={approved:0,pending:0}; if(s.status==='Approved')schemeSummary[s.name].approved++; else schemeSummary[s.name].pending++; }))

      return {id:index+1, name:vName, headCount:families.length, families, totalPeople, funds:{allocated:fundsAllocated, received:fundsReceived, pending:fundsPending}, schemes:schemeSummary}
    }

    let villages = []
    function generateMany(n=100){
      villages=[]
      for(let i=0;i<n;i++) villages.push(generateVillage(i))
      renderVillageList()
      updateSummary()
    }

    function renderVillageList(){
      const el = document.getElementById('villageList'); el.innerHTML=''
      villages.forEach(v=>{
        const div = document.createElement('div'); div.className='vitem'
        div.innerHTML = `<div style="flex:1"><strong>${v.name}</strong><div class='muted small'>Families: ${v.headCount} • People: ${v.totalPeople}</div></div><div style='text-align:right'><button data-id='${v.id}' class='viewBtn'>View</button></div>`
        el.appendChild(div)
      })
      document.querySelectorAll('.viewBtn').forEach(b=>b.addEventListener('click',ev=>{
        const id = Number(ev.target.dataset.id)
        selectVillage(id)
      }))
      document.getElementById('totalVillages').textContent = `Villages: ${villages.length}`
    }

    function updateSummary(){
      let people=0
      villages.forEach(v=>people+=v.totalPeople)
      document.getElementById('totalPeople').textContent = `Total People: ${people}`
    }

    let selectedVillage = null
    function selectVillage(id){
      const v = villages.find(x=>x.id===id)
      selectedVillage = v
      document.getElementById('selVillageTitle').textContent = v.name
      document.getElementById('selVillageSub').textContent = `Families: ${v.headCount} • People: ${v.totalPeople}`

      // Heads list
      const hArea = document.getElementById('headsArea'); hArea.innerHTML=''
      hArea.innerHTML = `<h3>Heads of Families</h3>`
      v.families.forEach((f,idx)=>{
        const btn = document.createElement('button'); btn.className='small'; btn.style.margin='6px 6px 6px 0'; btn.textContent = f.head
        btn.addEventListener('click',()=> showFamily(v,idx))
        hArea.appendChild(btn)
      })

      // Clear family area
      document.getElementById('familyArea').innerHTML = `<div class='muted small'>Select a head to view family tree and schemes</div>`

      // Details right panel
      renderDetails(v)
    }

    function showFamily(village, famIndex){
      const fam = village.families[famIndex]
      const area = document.getElementById('familyArea'); area.innerHTML=''
      area.innerHTML = `<h3>Family: ${fam.head}</h3><div class='muted small'>Members (${fam.members.length})</div>`
      const container = document.createElement('div'); container.className='family-tree'
      fam.members.forEach(m=>{
        const d = document.createElement('div'); d.style.margin='6px 0'; d.innerHTML = `<strong>${m.name}</strong> <span class='muted small'>(${m.relation}, age ${m.age})</span>`
        container.appendChild(d)
      })
      area.appendChild(container)

      // Schemes for this family
      const sch = document.createElement('div'); sch.style.marginTop='10px'
      sch.innerHTML = `<h4>Applied Schemes</h4>`
      if(fam.schemes.length===0) sch.innerHTML += `<div class='muted small'>No schemes applied</div>`
      else{
        const t = document.createElement('table')
        t.innerHTML = `<thead><tr><th>Scheme</th><th>Status</th><th>Reason</th></tr></thead>`
        const tbody = document.createElement('tbody')
        fam.schemes.forEach(s=>{
          const tr = document.createElement('tr')
          tr.innerHTML = `<td>${s.name}</td><td>${s.status}</td><td>${s.reason||'-'}</td>`
          tbody.appendChild(tr)
        })
        t.appendChild(tbody)
        sch.appendChild(t)
      }
      area.appendChild(sch)
    }

    function renderDetails(v){
      const area = document.getElementById('detailArea'); area.innerHTML = ''
      const fund = document.getElementById('fundSummary')
      fund.innerHTML = `<div><strong>Allocated:</strong> ₹${v.funds.allocated.toLocaleString()}<br><strong>Received:</strong> ₹${v.funds.received.toLocaleString()}<br><strong>Pending:</strong> ₹${v.funds.pending.toLocaleString()}</div>`

      const pending = document.getElementById('pendingSchemes')
      pending.innerHTML = ''
      const pendingList = []
      for(const k in v.schemes) if(v.schemes[k].pending>0) pendingList.push({name:k,count:v.schemes[k].pending})
      if(pendingList.length===0) pending.innerHTML = `<div class='muted small'>No pending schemes</div>`
      else{
        const ul = document.createElement('ul')
        pendingList.forEach(p=>{ const li=document.createElement('li'); li.textContent = `${p.name} — pending: ${p.count}`; ul.appendChild(li) })
        pending.appendChild(ul)
      }
    }

    // Show funds and schemes buttons
    document.getElementById('showFunds').addEventListener('click',()=>{
      if(!selectedVillage) return alert('Select a village first')
      alert(`${selectedVillage.name}\nAllocated: ₹${selectedVillage.funds.allocated.toLocaleString()}\nReceived: ₹${selectedVillage.funds.received.toLocaleString()}\nPending: ₹${selectedVillage.funds.pending.toLocaleString()}`)
    })
    document.getElementById('showSchemes').addEventListener('click',()=>{
      if(!selectedVillage) return alert('Select a village first')
      let txt = `${selectedVillage.name} - Scheme summary:\n`;
      for(const k in selectedVillage.schemes) txt += `${k}: Approved ${selectedVillage.schemes[k].approved || 0}, Pending ${selectedVillage.schemes[k].pending || 0}\n`
      alert(txt)
    })

    // CSV download
    function makeCSV(){
      // Flatten village data to CSV rows: village_id,village_name,headCount,totalPeople,allocated,received,pending,heads_count,all_schemes_summary
      const rows = [['village_id','village_name','headCount','totalPeople','allocated','received','pending','schemes_summary_json']]
      villages.forEach(v=>{
        rows.push([v.id, v.name, v.headCount, v.totalPeople, v.funds.allocated, v.funds.received, v.funds.pending, JSON.stringify(v.schemes)])
      })
      return rows.map(r=>r.map(c=>`"${String(c).replace(/"/g,'""')}"`).join(',')).join('\n')
    }
    document.getElementById('downloadCsv').addEventListener('click',()=>{
      const csv = makeCSV();
      const blob = new Blob([csv],{type:'text/csv'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href=url; a.download = 'villages_data.csv'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url)
    })

    document.getElementById('regen').addEventListener('click',()=>{ if(confirm('Generate fresh 100 villages? This will replace current sample data.')) generateMany(100) })

    // On load
    generateMany(100)
  </script>
</body>
</html>
