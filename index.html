<!doctype html>
<html lang="te">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Welcome to Muthyalathopu Village</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- PapaParse for CSV -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <style>
    /* small extras */
    .ticker { white-space: nowrap; overflow: hidden; }
    .ticker__move { display:inline-block; padding-left:100%; animation: ticker 18s linear infinite; }
    @keyframes ticker { 0% { transform: translateX(0); } 100% { transform: translateX(-100%);} }
    .card-img { object-fit: cover; }
    .modal-backdrop { background: rgba(0,0,0,0.6); }
  </style>
</head>
<body id="body" class="bg-gray-50 text-gray-900 transition-colors duration-300">

  <!-- Header -->
  <header id="header" class="sticky top-0 z-30">
    <div class="max-w-6xl mx-auto px-4 py-3 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
      <div class="flex-1">
        <h1 id="mainTitle" class="text-xl sm:text-2xl font-semibold">Welcome to Muthyalathopu Village</h1>
      </div>

      <div class="flex items-center gap-3">
        <label class="text-sm hidden sm:inline">Ln:</label>
        <select id="langSelect" class="border rounded p-1 text-sm">
          <option value="te">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</option>
          <option value="en">English</option>
        </select>

        <button id="themeToggle" class="ml-1 p-1 text-xl" title="Toggle theme">üåô</button>
      </div>
    </div>

    <!-- Modules -->
    <nav class="max-w-6xl mx-auto px-4 pb-3">
      <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
        <a id="aboutBtn" class="block bg-white rounded-2xl shadow p-4 text-center hover:bg-green-50">
          <div class="text-lg font-semibold telugu">‡∞ó‡±ç‡∞∞‡∞æ‡∞Æ‡∞Ç ‡∞ó‡±Å‡∞∞‡∞ø‡∞Ç‡∞ö‡∞ø</div>
          <div class="text-sm text-gray-500">About</div>
        </a>
        <a id="schemesBtn" class="block bg-white rounded-2xl shadow p-4 text-center hover:bg-green-50">
          <div class="text-lg font-semibold telugu">‡∞™‡∞•‡∞ï‡∞æ‡∞≤‡±Å</div>
          <div class="text-sm text-gray-500">Schemes</div>
        </a>
        <a id="adminBtn" class="block bg-white rounded-2xl shadow p-4 text-center hover:bg-green-50">
          <div class="text-lg font-semibold telugu">‡∞®‡∞ø‡∞∞‡±ç‡∞µ‡∞æ‡∞π‡∞ï‡±Å‡∞≤‡±Å</div>
          <div class="text-sm text-gray-500">Admin</div>
        </a>
      </div>
    </nav>
  </header>

  <!-- Main -->
  <main class="max-w-6xl mx-auto p-4 space-y-6">

    <!-- Flash News -->
    <section id="flashSection" class="bg-orange-50 border-l-4 border-orange-400 rounded p-3">
      <div class="flex items-center gap-3">
        <div class="text-orange-600 font-semibold">üì¢ Flash News</div>
        <div id="flashTicker" class="flex-1 ticker text-sm text-orange-800"></div>
      </div>
    </section>

    <!-- Village Peddalu (carousel) -->
    <section id="peddaluSection" class="bg-white rounded shadow p-3">
      <h2 class="text-lg font-semibold telugu mb-2">‡∞ó‡±ç‡∞∞‡∞æ‡∞Æ ‡∞™‡±Ü‡∞¶‡±ç‡∞¶‡∞≤ ‡∞µ‡∞ø‡∞µ‡∞∞‡∞æ‡∞≤‡±Å</h2>
      <div class="relative">
        <div id="peddaluCarousel" class="overflow-hidden rounded">
          <!-- slides inserted here -->
        </div>

        <!-- controls -->
        <div class="flex gap-2 justify-center mt-3">
          <button id="prevP" class="px-3 py-1 bg-gray-100 rounded">Prev</button>
          <button id="nextP" class="px-3 py-1 bg-gray-100 rounded">Next</button>
        </div>
      </div>
    </section>

    <!-- Village Photos -->
    <section id="photosSection" class="bg-white rounded shadow p-3">
      <h2 class="text-lg font-semibold mb-2 telugu">‡∞Æ‡∞æ ‡∞ó‡±ç‡∞∞‡∞æ‡∞Æ‡∞™‡±Å ‡∞ö‡∞ø‡∞§‡±ç‡∞∞‡∞æ‡∞≤‡±Å</h2>
      <div id="photosGrid" class="grid grid-cols-2 sm:grid-cols-3 gap-3">
        <!-- images inserted here -->
      </div>
    </section>

  </main>

  <!-- Image modal -->
  <div id="imgModal" class="fixed inset-0 hidden items-center justify-center z-50">
    <div class="modal-backdrop absolute inset-0"></div>
    <div class="relative z-10 max-w-3xl mx-auto p-4">
      <div class="bg-white rounded shadow-lg overflow-hidden">
        <div class="p-2 text-right"><button id="closeModal" class="px-2">Close</button></div>
        <div class="p-2"><img id="modalImg" src="" alt="photo" class="w-full h-96 object-contain" /></div>
      </div>
    </div>
  </div>

<script>
/* Configuration: folder names (Data with capital D) */
const DATA_FOLDER = '/Data';

/* Utility: fetch CSV and parse with PapaParse (returns Promise of array of objects) */
async function loadCSV(path) {
  return new Promise((res, rej) => {
    Papa.parse(path, { download: true, header: true, skipEmptyLines: true,
      complete: (results) => res(results.data),
      error: (err) => rej(err)
    });
  });
}

/* Theme toggle (day / moonlight) */
const body = document.getElementById('body');
const themeToggle = document.getElementById('themeToggle');
function applyTheme(dark) {
  if (dark) {
    body.classList.remove('bg-gray-50','text-gray-900');
    body.classList.add('bg-gradient-to-r','from-indigo-950','via-blue-900','to-slate-800','text-white');
    themeToggle.textContent = 'üåû';
  } else {
    body.classList.remove('bg-gradient-to-r','from-indigo-950','via-blue-900','to-slate-800','text-white');
    body.classList.add('bg-gray-50','text-gray-900');
    themeToggle.textContent = 'üåô';
  }
  localStorage.setItem('moonMode', dark ? '1' : '0');
}
const initialMoon = localStorage.getItem('moonMode') === '1';
applyTheme(initialMoon);
themeToggle.addEventListener('click', () => applyTheme(localStorage.getItem('moonMode') === '1' ? false : true));

/* Language (simple labels only) */
const langSelect = document.getElementById('langSelect');
langSelect.value = localStorage.getItem('lang') || 'te';
langSelect.addEventListener('change', e => { localStorage.setItem('lang', e.target.value); applyLang(); });
function applyLang(){
  const l = localStorage.getItem('lang') || 'te';
  // small labels (could be expanded)
  document.querySelectorAll('.telugu').forEach(el => {
    if (l === 'te') { el.style.display = ''; }
    else { /* leave visible but can change text if needed */ }
  });
}
applyLang();

/* ---------- Load and render CSV data ---------- */

async function initDashboard(){
  try {
    // flash news
    const flash = await loadCSV(`${DATA_FOLDER}/flash_news.csv`).catch(()=>[]);
    renderFlash(flash);

    // peddalu
    const peddalu = await loadCSV(`${DATA_FOLDER}/village_peddalu.csv`).catch(()=>[]);
    renderPeddalu(peddalu);

    // photos
    const photos = await loadCSV(`${DATA_FOLDER}/village_photos.csv`).catch(()=>[]);
    renderPhotos(photos);

  } catch (err) {
    console.error('Load error', err);
  }
}

/* Flash news: convert rows to ticker text */
function renderFlash(items) {
  const ticker = document.getElementById('flashTicker');
  if (!items || items.length === 0) {
    ticker.innerHTML = '<div class="text-sm text-orange-700">No flash news</div>';
    return;
  }
  // sort by date descending if date exists
  items.sort((a,b)=> (b.date||'').localeCompare(a.date||''));
  const parts = items.map(it => `${it.date ? '['+it.date+'] ' : ''}${it.title} ‚Äî ${it.description || ''}`);
  // build moving element
  const mover = document.createElement('div');
  mover.className = 'ticker__move';
  mover.textContent = parts.join('  ‚ö´  ');
  ticker.innerHTML = '';
  ticker.appendChild(mover);
}

/* Peddalu carousel */
let peddaluIndex = 0;
let peddaluSlides = [];
let peddaluTimer = null;

function renderPeddalu(items) {
  const wrap = document.getElementById('peddaluCarousel');
  wrap.innerHTML = '';
  peddaluSlides = items || [];
  if (!peddaluSlides || peddaluSlides.length === 0) {
    wrap.innerHTML = '<div class="p-4 text-sm text-gray-500">No elders data</div>';
    return;
  }

  // create slides (one at a time)
  function show(idx) {
    peddaluIndex = (idx + peddaluSlides.length) % peddaluSlides.length;
    const it = peddaluSlides[peddaluIndex];
    wrap.innerHTML = `
      <div class="flex flex-col sm:flex-row items-center gap-4 p-4">
        <div class="w-28 h-28 rounded-full overflow-hidden bg-gray-100">
          <img src="${it.photo_url || 'images/pedda.jpg'}" alt="${it.name}" class="w-full h-full object-cover card-img" />
        </div>
        <div>
          <div class="text-lg font-semibold">${it.role || ''}</div>
          <div class="text-xl font-bold mt-1">${it.name || ''}</div>
          <div class="text-sm text-gray-500 mt-1">${it.note || ''}</div>
        </div>
      </div>
    `;
  }

  // controls
  document.getElementById('prevP').onclick = () => { show(peddaluIndex-1); resetAuto(); };
  document.getElementById('nextP').onclick = () => { show(peddaluIndex+1); resetAuto(); };

  // start
  show(0);
  function auto() { peddaluTimer = setInterval(()=> show(peddaluIndex+1), 4000); }
  function resetAuto(){ clearInterval(peddaluTimer); auto(); }
  auto();
}

/* Photos grid */
function renderPhotos(items) {
  const grid = document.getElementById('photosGrid');
  grid.innerHTML = '';
  if (!items || items.length === 0) {
    grid.innerHTML = '<div class="text-sm text-gray-500">No photos</div>';
    return;
  }
  items.forEach(it => {
    const img = document.createElement('img');
    img.src = it.image_url || it.image || '';
    img.alt = it.title || '';
    img.className = 'w-full h-40 object-cover rounded cursor-pointer';
    img.addEventListener('click', ()=> openModal(img.src));
    grid.appendChild(img);
  });
}

/* modal */
function openModal(src){
  document.getElementById('modalImg').src = src;
  document.getElementById('imgModal').classList.remove('hidden');
  document.getElementById('imgModal').classList.add('flex');
}
document.getElementById('closeModal').addEventListener('click', ()=> {
  document.getElementById('imgModal').classList.add('hidden');
  document.getElementById('imgModal').classList.remove('flex');
});

/* Init */
initDashboard();

/* Simple navigation (scroll to sections) */
document.getElementById('aboutBtn').addEventListener('click', ()=> window.scrollTo({ top: 400, behavior: 'smooth' }));
document.getElementById('schemesBtn').addEventListener('click', ()=> window.scrollTo({ top: 700, behavior: 'smooth' }));
document.getElementById('adminBtn').addEventListener('click', ()=> window.scrollTo({ top: 1000, behavior: 'smooth' }));

</script>
</body>
</html>
