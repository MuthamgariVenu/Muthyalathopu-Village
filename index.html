<!doctype html>
<html lang="te">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>‡∞Æ‡±Å‡∞§‡±ç‡∞Ø‡∞æ‡∞≤‡∞§‡±ã‡∞™‡±Å ‡∞ó‡±ç‡∞∞‡∞æ‡∞Æ ‡∞¶‡∞∞‡±ç‡∞∂‡∞ø‡∞®‡∞ø ‚Äî About</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- PapaParse -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <!-- Leaflet (for interactive map) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <style>
    :root{
      --bg: #f8fafc; --card:#fff; --muted:#6b7280; --accent:#f97316; --text:#0f172a; --link:#2563eb;
    }
    .moon { --bg:#07102a; --card:rgba(255,255,255,0.04); --muted:#cbd5e1; --accent:#fb923c; --text:#e6f0ff; --link:#93c5fd; }
    body{ background:var(--bg); color:var(--text); transition: background .22s,color .22s; font-family: ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial; }
    .card{ background:var(--card); border-radius:10px; box-shadow: 0 1px 4px rgba(2,6,23,0.06); padding:0.75rem; transition: background .22s;}
    .muted { color:var(--muted); } .accent { color:var(--accent); } a.link{ color:var(--link); text-decoration:none; }
    /* ticker slow */
    .ticker { white-space: nowrap; overflow: hidden; }
    .ticker__move { display:inline-block; padding-left:100%; animation: ticker 55s linear infinite; }
    @keyframes ticker { 0%{ transform:translateX(0);} 100%{ transform:translateX(-100%);} }

    /* responsive */
    @media (max-width:640px){ .grid-md-2{ grid-template-columns: 1fr; } }
  </style>
</head>
<body id="body">

<!-- HEADER -->
<header class="sticky top-0 z-40">
  <div class="max-w-6xl mx-auto flex items-center justify-between gap-3 p-4">
    <div class="flex items-center gap-3">
      <button id="menuToggle" class="sm:hidden p-2 rounded card">‚ò∞</button>
      <img src="images/logo.png" alt="logo" class="w-10 h-10 rounded-full object-cover" onerror="this.style.display='none'">
      <div>
        <h1 id="mainTitle" class="text-xl font-bold telugu">‡∞Æ‡±Å‡∞§‡±ç‡∞Ø‡∞æ‡∞≤‡∞§‡±ã‡∞™‡±Å ‡∞ó‡±ç‡∞∞‡∞æ‡∞Æ ‡∞¶‡∞∞‡±ç‡∞∂‡∞ø‡∞®‡∞ø</h1>
        <div class="text-sm muted telugu">‡∞Æ‡∞® ‡∞ä‡∞∞‡∞ø ‡∞∏‡∞Æ‡∞æ‡∞ö‡∞æ‡∞∞‡∞Ç ‚Äî ‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</div>
      </div>
    </div>

    <div class="flex items-center gap-3">
      <nav class="hidden sm:flex gap-3">
        <button class="px-3 py-2 rounded card telugu" onclick="scrollToSection('about')">‡∞ó‡±ç‡∞∞‡∞æ‡∞Æ‡∞Ç ‡∞ó‡±Å‡∞∞‡∞ø‡∞Ç‡∞ö‡∞ø</button>
        <button class="px-3 py-2 rounded card telugu" onclick="scrollToSection('schemes')">‡∞™‡∞•‡∞ï‡∞æ‡∞≤‡±Å</button>
        <button class="px-3 py-2 rounded card telugu" onclick="scrollToSection('admin')">‡∞®‡∞ø‡∞∞‡±ç‡∞µ‡∞æ‡∞π‡∞ï‡±Å‡∞≤‡±Å</button>
      </nav>

      <!-- theme toggle -->
      <button id="themeToggle" class="ml-2 p-2 rounded card" title="‡∞∞‡∞æ‡∞§‡±ç‡∞∞‡∞ø/‡∞™‡∞ó‡∞≤‡±Å">{ }</button>
    </div>
  </div>
</header>

<!-- MOBILE SIDEBAR -->
<div id="sidebar" class="fixed inset-0 z-50 hidden">
  <div onclick="toggleSidebar(false)" class="absolute inset-0" style="background:rgba(0,0,0,0.45)"></div>
  <aside class="relative z-10 w-72 h-full card overflow-auto">
    <div class="flex items-center justify-between mb-4">
      <div class="flex items-center gap-3">
        <img src="images/logo.png" alt="logo" class="w-10 h-10 rounded-full object-cover" onerror="this.style.display='none'">
        <div>
          <div class="font-semibold telugu">‡∞Æ‡±Å‡∞§‡±ç‡∞Ø‡∞æ‡∞§‡±ã‡∞™‡±Å</div>
          <div class="text-sm muted telugu">‡∞Æ‡±Ü‡∞®‡±Ç</div>
        </div>
      </div>
      <button onclick="toggleSidebar(false)" class="p-2 rounded">‚úï</button>
    </div>
    <nav class="space-y-2">
      <a class="block p-2 rounded hover:bg-gray-50 telugu" onclick="toggleSidebar(false); scrollToSection('about')">‡∞ó‡±ç‡∞∞‡∞æ‡∞Æ‡∞Ç ‡∞ó‡±Å‡∞∞‡∞ø‡∞Ç‡∞ö‡∞ø</a>
      <a class="block p-2 rounded hover:bg-gray-50 telugu" onclick="toggleSidebar(false); scrollToSection('schemes')">‡∞™‡∞•‡∞ï‡∞æ‡∞≤‡±Å</a>
      <a class="block p-2 rounded hover:bg-gray-50 telugu" onclick="toggleSidebar(false); scrollToSection('admin')">‡∞®‡∞ø‡∞∞‡±ç‡∞µ‡∞æ‡∞π‡∞ï‡±Å‡∞≤‡±Å</a>
    </nav>
  </aside>
</div>

<!-- MAIN -->
<main class="max-w-6xl mx-auto p-4 space-y-6">

  <!-- Flash -->
  <section class="card">
    <div class="flex items-center gap-3">
      <div class="font-semibold telugu accent">üì¢ ‡∞§‡∞æ‡∞ú‡∞æ ‡∞µ‡∞æ‡∞∞‡±ç‡∞§‡∞≤‡±Å</div>
      <div id="flashTicker" class="flex-1 ticker muted telugu"></div>
    </div>
  </section>

  <!-- ABOUT MODULE -->
  <section id="about" class="space-y-4">
    <h2 class="text-2xl font-semibold telugu">‡∞ó‡±ç‡∞∞‡∞æ‡∞Æ‡∞Ç ‡∞ó‡±Å‡∞∞‡∞ø‡∞Ç‡∞ö‡∞ø</h2>

    <!-- 1. Basic Info -->
    <div id="basicInfo" class="card">
      <h3 class="font-semibold telugu">‡∞ó‡±ç‡∞∞‡∞æ‡∞Æ‡∞Ç ‚Äî ‡∞Æ‡±å‡∞≤‡∞ø‡∞ï ‡∞∏‡∞Æ‡∞æ‡∞ö‡∞æ‡∞∞‡∞Ç</h3>
      <div id="basicInfoContent" class="text-sm muted telugu mt-2">
        <!-- populated from village_info.csv or fallback -->
        ‡∞≤‡±ã‡∞°‡±ç ‡∞Ö‡∞µ‡±Å‡∞§‡±Å‡∞Ç‡∞¶‡∞ø...
      </div>
    </div>

    <!-- 2. Interactive Map (Leaflet) + households -->
    <div class="card">
      <h3 class="font-semibold telugu">‡∞ó‡±ç‡∞∞‡∞æ‡∞Æ ‡∞Æ‡±ç‡∞Ø‡∞æ‡∞™‡±ç (‡∞á‡∞Ç‡∞ü‡∞∞‡∞æ‡∞ï‡±ç‡∞ü‡∞ø‡∞µ‡±ç)</h3>
      <div id="villageMap" style="width:100%;height:360px;border-radius:8px;margin-top:8px;"></div>
      <div class="text-sm muted telugu mt-2">‡∞Æ‡∞æ‡∞∞‡±ç‡∞ï‡∞∞‡±ç‡∞≤‡±Å ‡∞á‡∞Ç‡∞ü‡∞ø‡∞ï‡∞ø ‡∞∏‡∞Ç‡∞¨‡∞Ç‡∞ß‡∞ø‡∞Ç‡∞ö‡∞ø‡∞® ‡∞µ‡∞æ‡∞ü‡∞ø‡∞®‡∞ø ‡∞ö‡±Ç‡∞™‡∞ø‡∞∏‡±ç‡∞§‡∞æ‡∞Ø‡∞ø. ‡∞ï‡±ç‡∞≤‡∞ø‡∞ï‡±ç ‡∞ö‡±á‡∞∏‡∞ø ‡∞ó‡∞Æ‡∞®‡∞æ‡∞≤‡±Å (Google directions) ‡∞§‡±Ü‡∞∞‡±Å‡∞ö‡±Å‡∞ï‡±ã‡∞µ‡∞ö‡±ç‡∞ö‡±Å.</div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">

      <!-- 3. Water & Electricity -->
      <div id="waterCard" class="card">
        <h4 class="font-semibold telugu">‡∞®‡±Ä‡∞∞‡±Å & ‡∞µ‡∞ø‡∞¶‡±ç‡∞Ø‡±Å‡∞§‡±ç ‡∞∏‡∞Æ‡∞æ‡∞ö‡∞æ‡∞∞‡∞Ç</h4>
        <div id="waterContent" class="text-sm muted telugu mt-2">‡∞≤‡±ã‡∞°‡±ç ‡∞Ö‡∞µ‡±Å‡∞§‡±Å‡∞Ç‡∞¶‡∞ø...</div>
      </div>

      <!-- 6. Emergency & Helpline -->
      <div id="helplineCard" class="card">
        <h4 class="font-semibold telugu">‡∞Ö‡∞§‡±ç‡∞Ø‡∞æ‡∞µ‡∞∂‡±ç‡∞Ø‡∞ï ‡∞∏‡∞π‡∞æ‡∞Ø‡∞Ç & ‡∞π‡±Ü‡∞≤‡±ç‡∞™‡±ç‚Äå‡∞≤‡±à‡∞®‡±ç</h4>
        <div id="helplineContent" class="text-sm muted telugu mt-2">‡∞≤‡±ã‡∞°‡±ç ‡∞Ö‡∞µ‡±Å‡∞§‡±Å‡∞Ç‡∞¶‡∞ø...</div>
      </div>

    </div>

    <!-- 7. Panchayat & Committee Members -->
    <div class="card">
      <h3 class="font-semibold telugu">‡∞™‡∞Ç‡∞ö‡∞æ‡∞Ø‡∞ø‡∞§‡±Ä & ‡∞ï‡∞Æ‡∞ø‡∞ü‡±Ä ‡∞∏‡∞≠‡±ç‡∞Ø‡±Å‡∞≤‡±Å</h3>
      <div id="committeeList" class="mt-3 grid grid-cols-1 sm:grid-cols-2 gap-3">
        <!-- Filled from CSV -->
      </div>
    </div>

    <!-- 8. Festivals & Events calendar -->
    <div class="card">
      <h3 class="font-semibold telugu">‡∞™‡∞Ç‡∞°‡±Å‡∞ó‡∞≤‡±Å & ‡∞à‡∞µ‡±Ü‡∞Ç‡∞ü‡±ç‡∞∏‡±ç ‡∞ï‡∞æ‡∞≤‡±Ü‡∞Ç‡∞°‡∞∞‡±ç</h3>
      <div id="eventsList" class="mt-3 text-sm muted telugu">‡∞≤‡±ã‡∞°‡±ç ‡∞Ö‡∞µ‡±Å‡∞§‡±Å‡∞Ç‡∞¶‡∞ø...</div>
    </div>

    <!-- Links to other modules -->
    <div class="card flex gap-3 items-center">
      <div class="text-sm telugu">‡∞á‡∞§‡∞∞ ‡∞Æ‡∞æ‡∞°‡±ç‡∞Ø‡±Ç‡∞≤‡±ç‡∞∏‡±ç:</div>
      <button class="px-3 py-2 rounded card telugu" onclick="scrollToSection('schemes')">‡∞™‡∞•‡∞ï‡∞æ‡∞≤‡±Å</button>
      <button class="px-3 py-2 rounded card telugu" onclick="scrollToSection('admin')">‡∞®‡∞ø‡∞∞‡±ç‡∞µ‡∞æ‡∞π‡∞ï‡±Å‡∞≤‡±Å</button>
    </div>

  </section>

  <!-- SCHEMES placeholder -->
  <section id="schemes" class="card">
    <h2 class="text-xl font-semibold telugu">‡∞™‡∞•‡∞ï‡∞æ‡∞≤‡±Å</h2>
    <div class="text-sm muted telugu mt-2">(‡∞á‡∞ï‡±ç‡∞ï‡∞° ‡¶™‡∞•‡∞ï‡∞æ‡∞≤ summary, ‡∞∏‡∞Ç‡∞ñ‡±ç‡∞Ø‡∞≤‡±Å, beneficiary list ‡∞µ‡∞Ç‡∞ü‡∞ø features ‡∞§‡∞∞‡±ç‡∞µ‡∞æ‡∞§ ‡∞á‡∞∏‡±ç‡∞§‡∞æ‡∞Ç.)</div>
  </section>

  <!-- ADMIN placeholder (sachivalayam card included) -->
  <section id="admin" class="card">
    <h2 class="text-xl font-semibold telugu">‡∞®‡∞ø‡∞∞‡±ç‡∞µ‡∞æ‡∞π‡∞ï‡±Å‡∞≤‡±Å</h2>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-3">
      <div class="md:col-span-2">
        <h3 class="font-semibold telugu">‡∞ó‡±ç‡∞∞‡∞æ‡∞Æ ‡∞™‡±Ü‡∞¶‡±ç‡∞¶‡∞≤‡±Å (‡∞™‡±Ü‡∞°‡±ç‡∞°‡±Å/‡∞Æ‡∞ß‡±ç‡∞Ø/‡∞ö‡∞ø‡∞®‡±ç‡∞®) - carousel</h3>
        <div id="peddaluCarousel" class="mt-3 card"></div>
        <div class="flex gap-2 mt-2">
          <button id="prevP" class="px-3 py-1 rounded card telugu">‡∞Æ‡±Å‡∞Ç‡∞¶‡±Å‡∞ï‡±Å</button>
          <button id="nextP" class="px-3 py-1 rounded card telugu">‡∞§‡∞∞‡±ç‡∞µ‡∞æ‡∞§</button>
        </div>
      </div>

      <div class="card">
        <h3 class="font-semibold telugu">‡∞∏‡∞ö‡∞ø‡∞µ‡∞æ‡∞≤‡∞Ø‡∞Ç ‡∞∏‡∞Æ‡∞æ‡∞ö‡∞æ‡∞∞‡∞Ç</h3>
        <div id="sachivalayamCard" class="text-sm mt-2 telugu">
          <div><strong>‡∞∏‡∞ö‡∞ø‡∞µ‡∞æ‡∞≤‡∞Ø ‡∞Ö‡∞ß‡∞ø‡∞ï‡∞æ‡∞∞‡∞ø:</strong> <span id="secName">‡∞é‡∞Ç. ‡∞∏‡±Ä‡∞§‡∞æ‡∞∞‡∞æ‡∞Ç</span></div>
          <div>‡∞´‡±ã‡∞®‡±ç: <a id="secPhone" class="link" href="tel:+919876543210">+91 98765 43210</a></div>
          <div class="mt-2"><strong>VRO:</strong> <span id="vroName">‡∞¨‡∞ø. ‡∞∞‡∞µ‡∞ø‡∞ï‡∞æ‡∞Ç‡∞§‡±ç</span></div>
          <div>‡∞´‡±ã‡∞®‡±ç: <a id="vroPhone" class="link" href="tel:+919988766554">+91 99887 66554</a></div>
        </div>
      </div>
    </div>
  </section>

</main>

<!-- Image modal (used by peddalu if images) -->
<div id="imgModal" class="fixed inset-0 hidden items-center justify-center z-50">
  <div class="absolute inset-0" style="background:rgba(0,0,0,0.6)"></div>
  <div class="relative z-10 max-w-3xl w-full p-4">
    <div class="card">
      <div class="text-right"><button id="closeModal" class="px-2 telugu">‡∞Æ‡±Ç‡∞∏‡∞ø‡∞µ‡±á‡∞Ø‡∞ø</button></div>
      <img id="modalImg" src="" alt="photo" class="w-full object-contain"/>
    </div>
  </div>
</div>

<script>
/* ----------------------
  Utilities & CSV loader
   - Put CSVs in /Data/ folder
   - Files used:
     Data/flash_news.csv
     Data/village_info.csv
     Data/households.csv
     Data/water_elec.csv
     Data/helpline.csv
     Data/committee.csv
     Data/events.csv
     Data/village_peddalu.csv
-----------------------*/
function loadCSV(path){
  return new Promise((resolve,reject)=>{
    Papa.parse(path, { download:true, header:true, skipEmptyLines:true,
      complete: (res)=> resolve(res.data),
      error: (err)=> reject(err)
    });
  });
}

/* ----------------------
   Theme toggle (moon/light)
-----------------------*/
const themeToggleBtn = document.getElementById('themeToggle');
function applyTheme(isMoon){
  if(isMoon) document.documentElement.classList.add('moon');
  else document.documentElement.classList.remove('moon');
  localStorage.setItem('muthya_theme_moon', isMoon ? '1' : '0');
  themeToggleBtn.textContent = isMoon ? 'üåû' : 'üåô';
}
const savedMoon = localStorage.getItem('muthya_theme_moon') === '1';
applyTheme(savedMoon);
themeToggleBtn.addEventListener('click', ()=> applyTheme(!document.documentElement.classList.contains('moon')));

/* Sidebar toggle */
const sidebarEl = document.getElementById('sidebar');
document.getElementById('menuToggle').addEventListener('click', ()=> sidebarEl.classList.toggle('hidden'));
function toggleSidebar(v){ sidebarEl.classList.toggle('hidden', v===undefined ? undefined : !v); }

/* Scroll helper */
function scrollToSection(id){
  const el = document.getElementById(id);
  if(el) el.scrollIntoView({ behavior:'smooth', block:'start' });
}

/* ----------------------
   Flash News ticker (Telugu)
-----------------------*/
async function renderFlash(){
  const ticker = document.getElementById('flashTicker');
  try{
    const data = await loadCSV('Data/flash_news.csv');
    if(!data || !data.length) throw 'no';
    const parts = data.map(it => {
      const d = it.date ? `[ ${it.date} ] ` : '';
      return `${d}${it.title || ''} ‚Äî ${it.description || ''}`;
    });
    const mover = document.createElement('div'); mover.className='ticker__move telugu';
    mover.textContent = parts.join('   ‚ö´   ');
    ticker.innerHTML = ''; ticker.appendChild(mover);
  }catch(e){
    ticker.innerHTML = '<div class="muted telugu">‡∞§‡∞æ‡∞ú‡∞æ ‡∞µ‡∞æ‡∞∞‡±ç‡∞§‡∞≤‡±Å ‡∞≤‡±á‡∞µ‡±Å</div>';
  }
}

/* ----------------------
   1. Village Basic Info
   Data format: village_info.csv with keys:
   village_name_tel,village_name_en,mandal,district,pop_total,pop_male,pop_female,total_houses,main_occupations
-----------------------*/
async function renderBasicInfo(){
  const container = document.getElementById('basicInfoContent');
  try{
    const rows = await loadCSV('Data/village_info.csv');
    const r = (rows && rows[0]) ? rows[0] : null;
    if(!r) throw 'no';
    container.innerHTML = `
      <div><strong>‡∞ó‡±ç‡∞∞‡∞æ‡∞Æ‡∞Ç:</strong> ${r.village_name_tel || r.village_name_en || '‚Äî' } ${r.village_name_en ? '('+r.village_name_en+')' : ''}</div>
      <div><strong>‡∞Æ‡∞Ç‡∞°‡∞≤‡∞Ç:</strong> ${r.mandal || '‚Äî'}</div>
      <div><strong>‡∞ú‡∞ø‡∞≤‡±ç‡∞≤‡∞æ:</strong> ${r.district || '‚Äî'}</div>
      <div><strong>‡∞∏‡∞Ç‡∞ñ‡±ç‡∞Ø‡∞≤‡±Å:</strong> ‡∞ú‡∞®‡∞æ‡∞≠‡∞æ ‡∞Æ‡±ä‡∞§‡±ç‡∞§‡∞Ç ${r.pop_total || '‚Äî'} (‡∞™‡±Å‡∞∞‡±Å‡∞∑‡±Å‡∞≤‡±Å ${r.pop_male || '‚Äî'}, ‡∞Æ‡∞π‡∞ø‡∞≥‡∞≤‡±Å ${r.pop_female || '‚Äî'})</div>
      <div><strong>‡∞á‡∞≥‡±ç‡∞≥ ‡∞∏‡∞Ç‡∞ñ‡±ç‡∞Ø:</strong> ${r.total_houses || '‚Äî'}</div>
      <div><strong>‡∞™‡±ç‡∞∞‡∞ß‡∞æ‡∞® ‡∞ï‡∞æ‡∞∞‡±ç‡∞Ø‡∞ï‡∞≤‡∞æ‡∞™‡∞æ‡∞≤‡±Å:</strong> ${r.main_occupations || '‚Äî'}</div>
    `;
  }catch(err){
    // fallback static info
    container.innerHTML = `
      <div><strong>‡∞ó‡±ç‡∞∞‡∞æ‡∞Æ‡∞Ç:</strong> ‡∞Æ‡±Å‡∞§‡±ç‡∞Ø‡∞æ‡∞≤‡∞≤‡±ã‡∞™‡±Å (Mutyalathopupalem)</div>
      <div><strong>‡∞Æ‡∞Ç‡∞°‡∞≤‡∞Ç:</strong> ‡∞§‡±ã‡∞ü‡∞™‡∞≤‡±ç‡∞≤‡∞ø‡∞ó‡±Ç‡∞°‡±Ç‡∞∞‡±Å</div>
      <div><strong>‡∞ú‡∞ø‡∞≤‡±ç‡∞≤‡∞æ:</strong> ‡∞®‡±Ü‡∞≤‡±ç‡∞≤‡±Ç‡∞∞‡±Å</div>
      <div><strong>‡∞∏‡∞Ç‡∞ñ‡±ç‡∞Ø‡∞≤‡±Å:</strong> ‡∞ú‡∞®‡∞æ‡∞≠‡∞æ ‡∞∏‡∞Æ‡∞æ‡∞ö‡∞æ‡∞∞‡∞Ç ‡∞≤‡±á‡∞ï‡∞™‡±ã‡∞§‡±á admin ‡∞¶‡±ç‡∞µ‡∞æ‡∞∞‡∞æ ‡∞Ö‡∞™‡±ç‡∞°‡±á‡∞ü‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø</div>
      <div><strong>‡∞á‡∞≥‡±ç‡∞≥ ‡∞∏‡∞Ç‡∞ñ‡±ç‡∞Ø:</strong> ‚Äî</div>
      <div><strong>‡∞™‡±ç‡∞∞‡∞ß‡∞æ‡∞® ‡∞ï‡∞æ‡∞∞‡±ç‡∞Ø‡∞ï‡∞≤‡∞æ‡∞™‡∞æ‡∞≤‡±Å:</strong> ‡∞µ‡±ç‡∞Ø‡∞µ‡∞∏‡∞æ‡∞Ø‡∞Ç, ‡∞Æ‡∞§‡±ç‡∞∏‡±ç‡∞Ø‡∞ï‡∞æ‡∞∞‡±Å‡∞°‡±Å</div>
    `;
  }
}

/* ----------------------
   2. Interactive map (Leaflet) - load households.csv with lat,lon,name,house_id
   households.csv sample:
   id,house_id,name,lat,lon,address
-----------------------*/
async function initVillageMap(){
  const defaultCenter = [14.4371,80.0224]; // approx; change if needed
  const map = L.map('villageMap', { zoomControl:true }).setView(defaultCenter, 16);

  const esri = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
    maxZoom:19, attribution:'Tiles ¬© Esri'
  }).addTo(map);

  const street = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom:19, attribution:'¬© OpenStreetMap' });

  L.control.layers({"Satellite":esri,"Road":street}, null, { collapsed:true, position:'topright' }).addTo(map);

  // try load households
  try{
    const data = await loadCSV('Data/households.csv');
    const markers = [];
    data.forEach(row=>{
      const lat = parseFloat(row.lat || row.latitude || '');
      const lon = parseFloat(row.lon || row.longitude || '');
      if(!isFinite(lat) || !isFinite(lon)) return;
      const name = row.name || row.house_id || '‡∞Ö‡∞ú‡±ç‡∞û‡∞æ‡∞§';
      const house = row.house_id || '';
      const addr = row.address || '';
      const popup = `
        <div style="min-width:180px">
          <div style="font-weight:600">${name}</div>
          <div style="font-size:13px;color:#444">${house} ${addr ? '¬∑ ' + addr : ''}</div>
          <div style="margin-top:6px"><a class="link" target="_blank" href="https://www.google.com/maps/dir/?api=1&destination=${lat},${lon}">Google ‡∞¶‡∞ø‡∞∂‡∞≤‡±Å</a></div>
        </div>`;
      const m = L.marker([lat,lon]).addTo(map).bindPopup(popup);
      markers.push(m);
    });
    if(markers.length){
      const g = L.featureGroup(markers);
      map.fitBounds(g.getBounds().pad(0.15));
    }
  }catch(e){
    console.warn('households.csv not loaded', e);
    // leave map at default center
  }
}

/* ----------------------
  3. Water & Electricity (water_elec.csv)
   columns: type, detail (e.g., borewells:5; supply_schedule: 6-8 AM)
-----------------------*/
async function renderWater(){
  const el = document.getElementById('waterContent');
  try{
    const rows = await loadCSV('Data/water_elec.csv');
    if(!rows || !rows.length) throw 'no';
    let html = '';
    rows.forEach(r=>{
      html += `<div><strong>${r.type || '‚Äî'}:</strong> ${r.detail || '‚Äî'}</div>`;
    });
    el.innerHTML = html;
  }catch(e){
    el.innerHTML = `<div class="muted telugu">‡∞®‡±Ä‡∞∞‡±Å/‡∞µ‡∞ø‡∞¶‡±ç‡∞Ø‡±Å‡∞§‡±ç ‡∞µ‡∞ø‡∞µ‡∞∞‡∞æ‡∞≤‡±Å ‡∞™‡±ç‡∞∞‡∞∏‡±ç‡∞§‡±Å‡∞§‡∞Ç ‡∞Ö‡∞Ç‡∞¶‡±Å‡∞¨‡∞æ‡∞ü‡±Å‡∞≤‡±ã ‡∞≤‡±á‡∞µ‡±Å. admin ‡∞¶‡±ç‡∞µ‡∞æ‡∞∞‡∞æ ‡∞Ö‡∞™‡±ç‡∞°‡±á‡∞ü‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø.</div>`;
  }
}

/* ----------------------
  6. Helpline (helpline.csv)
   columns: role,name,phone
-----------------------*/
async function renderHelpline(){
  const el = document.getElementById('helplineContent');
  try{
    const rows = await loadCSV('Data/helpline.csv');
    if(!rows || !rows.length) throw 'no';
    let html = '<ul class="list-disc pl-5">';
    rows.forEach(r=>{
      html += `<li><strong>${r.role || r.name || '‚Äî'}:</strong> <a class="link" href="tel:${r.phone || ''}">${r.phone || '‚Äî'}</a></li>`;
    });
    html += '</ul>';
    el.innerHTML = html;
  }catch(e){
    el.innerHTML = `<div class="muted telugu">‡∞π‡±Ü‡∞≤‡±ç‡∞™‡±ç‚Äå‡∞≤‡±à‡∞®‡±ç ‡∞∏‡∞Æ‡∞æ‡∞ö‡∞æ‡∞∞‡∞Ç ‡∞≤‡±á‡∞®‡∞ø‡∞¶‡∞ø. admin ‡∞¶‡±ç‡∞µ‡∞æ‡∞∞‡∞æ ‡∞ú‡∞Æ ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø.</div>`;
  }
}

/* ----------------------
  7. Committee members (committee.csv)
   columns: id,role,name,photo_url,phone,note
-----------------------*/
async function renderCommittee(){
  const box = document.getElementById('committeeList');
  try{
    const rows = await loadCSV('Data/committee.csv');
    if(!rows || !rows.length) throw 'no';
    box.innerHTML = '';
    rows.forEach(r=>{
      const card = document.createElement('div');
      card.className = 'p-3 card flex gap-3 items-center';
      card.innerHTML = `
        <div class="w-14 h-14 rounded-full overflow-hidden bg-gray-100">
          <img src="${r.photo_url || 'images/pedda.jpg'}" alt="${r.name||''}" class="w-full h-full object-cover">
        </div>
        <div>
          <div class="font-semibold telugu">${r.role || ''}</div>
          <div class="telugu">${r.name || ''} ${r.note ? '¬∑ ' + r.note : ''}</div>
          <div><a class="link" href="tel:${r.phone || ''}">${r.phone || ''}</a></div>
        </div>
      `;
      box.appendChild(card);
    });
  }catch(e){
    box.innerHTML = `<div class="muted telugu">‡∞™‡∞Ç‡∞ö‡∞æ‡∞Ø‡∞ø‡∞§‡±Ä ‡∞∏‡∞≠‡±ç‡∞Ø‡±Å‡∞≤‡±Å ‡∞°‡±á‡∞ü‡∞æ ‡∞≤‡±á‡∞®‡∞ø‡∞µ‡∞ø.</div>`;
  }
}

/* ----------------------
  8. Events (events.csv)
  columns: id,title,date,start_date,end_date,description,location
-----------------------*/
async function renderEvents(){
  const el = document.getElementById('eventsList');
  try{
    const rows = await loadCSV('Data/events.csv');
    if(!rows || !rows.length) throw 'no';
    // sort by date if present
    rows.sort((a,b)=> (a.date||'').localeCompare(b.date||''));
    let html = '<div class="space-y-3">';
    rows.forEach(r=>{
      html += `<div class="p-2 card">
        <div class="font-semibold telugu">${r.title || ''} <span class="muted text-sm">(${r.date||''})</span></div>
        <div class="muted telugu text-sm mt-1">${r.description || ''}</div>
        ${ r.location ? '<div class="mt-1"><strong class="telugu">‡∞∏‡±ç‡∞•‡∞≤‡∞Ç:</strong> ' + r.location + '</div>' : '' }
      </div>`;
    });
    html += '</div>';
    el.innerHTML = html;
  }catch(e){
    el.innerHTML = `<div class="muted telugu">‡∞à‡∞µ‡±Ü‡∞Ç‡∞ü‡±ç‡∞∏‡±ç ‡∞°‡±á‡∞ü‡∞æ ‡∞≤‡±á‡∞®‡∞ø‡∞µ‡∞ø.</div>`;
  }
}

/* ----------------------
  Peddalu carousel (role,name,note,photo_url) - used in admin section
-----------------------*/
let pidx=0, pslides=[], ptimer;
async function renderPeddalu(){
  const wrap = document.getElementById('peddaluCarousel');
  try{
    const rows = await loadCSV('Data/village_peddalu.csv');
    pslides = rows || [];
    if(!pslides.length) throw 'no';
  }catch(e){
    pslides = [];
  }
  if(!pslides.length){
    wrap.innerHTML = '<div class="muted telugu p-4">‡∞™‡±Ü‡∞¶‡±ç‡∞¶‡∞≤ ‡∞µ‡∞ø‡∞µ‡∞∞‡∞æ‡∞≤‡±Å ‡∞≤‡±á‡∞µ‡±Å</div>';
    return;
  }
  function show(i){
    pidx = (i + pslides.length) % pslides.length;
    const it = pslides[pidx];
    wrap.innerHTML = `
      <div class="flex items-center gap-4">
        <div class="w-20 h-20 rounded-full overflow-hidden bg-gray-100">
          <img src="${it.photo_url||'images/pedda.jpg'}" alt="${it.name||''}" class="w-full h-full object-cover">
        </div>
        <div>
          <div class="font-semibold telugu">${it.role||''}</div>
          <div class="text-lg font-bold telugu mt-1">${it.name||''}</div>
          <div class="muted telugu mt-1">${it.note||''}</div>
        </div>
      </div>
    `;
  }
  document.getElementById('prevP').onclick = ()=>{ show(pidx-1); resetAuto(); };
  document.getElementById('nextP').onclick = ()=>{ show(pidx+1); resetAuto(); };
  show(0);
  function auto(){ ptimer = setInterval(()=> show(pidx+1), 4500); }
  function resetAuto(){ clearInterval(ptimer); auto(); }
  auto();
}

/* ----------------------
   Init everything
-----------------------*/
renderFlash();
renderBasicInfo();
initVillageMap();
renderWater();
renderHelpline();
renderCommittee();
renderEvents();
renderPeddalu();

/* modal handlers for images */
document.getElementById('closeModal').addEventListener('click', ()=>{
  document.getElementById('imgModal').classList.add('hidden');
});
function openModal(src){ document.getElementById('modalImg').src = src; document.getElementById('imgModal').classList.remove('hidden'); }

</script>
</body>
</html>
