<!doctype html>
<html lang="te">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>‡∞Æ‡±Å‡∞§‡±ç‡∞Ø‡∞æ‡∞≤‡∞≤‡±ã‡∞™‡±Å ‚Äî ‡∞°‡∞æ‡∞∑‡±ç‚Äå‡∞¨‡±ã‡∞∞‡±ç‡∞°‡±ç</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <style>
    /* ----- Theme variables ----- */
    :root{
      --bg: #f8fafc;
      --card: #ffffff;
      --muted: #6b7280;
      --accent: #f97316;
      --text: #0f172a;
      --header-bg: #ffffff;
      --footer-bg: #f8fafc;

      /* Buttons (day) */
      --btn-bg: #f3f4f6;
      --btn-text: #0f172a;
      --btn-border: rgba(2,6,23,0.06);

      /* subtle pill */
      --pill-bg: #eef2ff;
      --pill-text: #0f172a;

      /* special left-bar colors */
      --bar-pension: #f97316;
      --bar-state: #10b981;
      --bar-central: #3b82f6;
      --bar-other: #94a3b8;
    }

    /* Dark / Moon theme */
    .moon{
      --bg: #07102a;
      --card: rgba(255,255,255,0.03);
      --muted: #cbd5e1;
      --accent: #fb923c;
      --text: #e6f0ff;
      --header-bg: rgba(255,255,255,0.03);
      --footer-bg: #04102a;

      /* Buttons (dark) - visible contrast */
      --btn-bg: rgba(255,255,255,0.06);
      --btn-text: #e6f0ff;
      --btn-border: rgba(255,255,255,0.06);

      --pill-bg: rgba(255,255,255,0.03);
      --pill-text: #e6f0ff;

      --bar-pension: #fb923c;
      --bar-state: #34d399;
      --bar-central: #60a5fa;
      --bar-other: #94a3b8;
    }

    /* ----- Base styles ----- */
    html,body{ height:100%; margin:0; font-family: ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Arial; background:var(--bg); color:var(--text); transition:background .18s, color .18s; }
    header{ position:fixed; top:0; left:0; right:0; z-index:50; background:var(--header-bg); box-shadow:0 2px 6px rgba(2,6,23,0.06); }
    .hdr{ max-width:1100px; margin:0 auto; display:flex; align-items:center; justify-content:space-between; padding:10px 14px; gap:12px; }
    .logo{ width:44px; height:44px; border-radius:8px; object-fit:cover; }

    .title-main{ font-weight:700; font-size:1rem; }
    .title-sub{ font-size:0.78rem; color:var(--muted); }

    .modules{ display:none; gap:10px; }
    @media(min-width:768px){ .modules{ display:flex; } .title-main{ font-size:1.2rem; } .hdr{ padding:14px 18px; } }

    main{ max-width:1100px; margin:0 auto; padding:92px 14px 88px; }

    .card{ background:var(--card); border-radius:10px; padding:14px; box-shadow:0 1px 4px rgba(2,6,23,0.04); color:var(--text); transition:background .18s, color .18s; }
    .muted{ color:var(--muted); }
    .accent{ color:var(--accent); }
    a.link{ color:var(--accent); text-decoration:none; }

    /* Flash ticker slow */
    .ticker{ white-space:nowrap; overflow:hidden; }
    .ticker__move{ display:inline-block; padding-left:100%; animation:ticker 60s linear infinite; }
    @keyframes ticker{ 0%{ transform:translateX(0);} 100%{ transform:translateX(-100%);} }

    /* Buttons use variables for day/dark */
    .btn{
      padding:8px 12px;
      border-radius:10px;
      background:var(--btn-bg);
      color:var(--btn-text);
      cursor:pointer;
      border:1px solid var(--btn-border);
      font-weight:600;
      box-shadow:none;
    }
    .btn.link{ background:transparent; color:var(--accent); border:1px solid rgba(0,0,0,0); padding:6px 10px; }
    .btn:active{ transform:translateY(1px); }

    .pill{ display:inline-block; padding:6px 10px; border-radius:999px; background:var(--pill-bg); color:var(--pill-text); font-size:0.92rem; }

    /* mobile menu (sidebar) */
    #mobileMenu{ position:fixed; inset:0; z-index:60; display:none; align-items:flex-start; justify-content:flex-end; }
    #mobileMenu .backdrop{ position:absolute; inset:0; background:rgba(0,0,0,0.45); }
    #mobileMenu .panel{
      position:relative; width:84%; max-width:320px; height:100%;
      background:var(--card); color:var(--text); padding:16px; overflow:auto; box-shadow:-8px 0 20px rgba(2,6,23,0.12);
    }

    /* Elders carousel */
    .carousel-wrap{ position:relative; overflow:hidden; border-radius:8px; }
    .carousel-inner{ display:flex; gap:12px; transition:transform .36s ease; }
    .carousel-card{ min-width:100%; box-sizing:border-box; padding:12px; display:flex; gap:12px; align-items:center; background:var(--card); border-radius:8px; }
    .avatar-lg{ width:84px; height:84px; border-radius:9999px; object-fit:cover; background:#f3f4f6; }

    @media(min-width:768px){ .carousel-card{ min-width:50%; } }

    /* footer */
    footer{ position:fixed; left:0; right:0; bottom:0; z-index:40; background:var(--footer-bg); color:var(--text); padding:12px 14px; box-shadow:0 -2px 6px rgba(2,6,23,0.06); text-align:center; transition:background .18s, color .18s; font-size:0.92rem; }

    /* scheme left bar colors */
    .left-bar{ width:6px; border-radius:6px; margin-right:12px; }
    .bar-pension{ background:var(--bar-pension); }
    .bar-state{ background:var(--bar-state); }
    .bar-central{ background:var(--bar-central); }
    .bar-other{ background:var(--bar-other); }

    /* small responsive tweaks */
    @media(max-width:600px){
      header .hdr{ padding:10px; }
    }
  </style>
</head>
<body id="body">

<header>
  <div class="hdr">
    <div style="display:flex;gap:10px;align-items:center;min-width:0;">
      <img src="images/logo.png" alt="‡∞≤‡∞æ‡∞ó‡±ã" class="logo" onerror="this.style.display='none'">
      <div style="min-width:0;">
        <div class="title-main telugu">‡∞Æ‡±Å‡∞§‡±ç‡∞Ø‡∞æ‡∞≤‡∞≤‡±ã‡∞™‡±Å ‡∞ó‡±ç‡∞∞‡∞æ‡∞Æ‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞∏‡±ç‡∞µ‡∞æ‡∞ó‡∞§‡∞Ç</div>
        <div class="title-sub telugu">‡∞Æ‡∞® ‡∞ä‡∞∞‡∞ø ‡∞∏‡∞Æ‡∞æ‡∞ö‡∞æ‡∞∞‡∞Ç ‚Äî ‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</div>
      </div>
    </div>

    <div style="display:flex;align-items:center;gap:8px;">
      <nav class="modules">
        <a href="about.html" class="btn telugu tiny">‡∞ó‡±ç‡∞∞‡∞æ‡∞Æ‡∞Ç ‡∞ó‡±Å‡∞∞‡∞ø‡∞Ç‡∞ö‡∞ø</a>
        <a href="schemes.html" class="btn telugu tiny">‡∞™‡∞•‡∞ï‡∞æ‡∞≤‡±Å</a>
        <a href="admin.html" class="btn telugu tiny">‡∞®‡∞ø‡∞∞‡±ç‡∞µ‡∞æ‡∞π‡∞ï‡±Å‡∞≤‡±Å</a>
      </nav>

      <button id="openMenuBtn" class="btn md:hidden" aria-label="‡∞Æ‡±Ü‡∞®‡±Ç">‚ò∞</button>
    </div>
  </div>
</header>

<!-- MOBILE MENU -->
<div id="mobileMenu" aria-hidden="true">
  <div class="backdrop" onclick="closeMenu()"></div>
  <div class="panel">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;">
      <div style="display:flex;gap:10px;align-items:center;">
        <img src="images/logo.png" alt="logo" class="logo" onerror="this.style.display='none'">
        <div>
          <div class="font-semibold telugu">‡∞Æ‡±Å‡∞§‡±ç‡∞Ø‡∞æ‡∞≤‡∞≤‡±ã‡∞™‡±Å</div>
          <div class="tiny muted telugu">‡∞Æ‡±Ü‡∞®‡±Ç</div>
        </div>
      </div>
      <button onclick="closeMenu()" class="btn">‚úï</button>
    </div>

    <nav style="display:flex;flex-direction:column;gap:10px;">
      <a href="about.html" class="btn telugu">‡∞ó‡±ç‡∞∞‡∞æ‡∞Æ‡∞Ç ‡∞ó‡±Å‡∞∞‡∞ø‡∞Ç‡∞ö‡∞ø</a>
      <a href="schemes.html" class="btn telugu">‡∞™‡∞•‡∞ï‡∞æ‡∞≤‡±Å</a>
      <a href="admin.html" class="btn telugu">‡∞®‡∞ø‡∞∞‡±ç‡∞µ‡∞æ‡∞π‡∞ï‡±Å‡∞≤‡±Å</a>
    </nav>

    <div style="margin-top:18px; display:flex; align-items:center; justify-content:space-between;">
      <div class="tiny muted telugu">‡∞≠‡∞æ‡∞∑: ‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</div>
      <button id="moonToggleSidebar" class="btn tiny" title="‡∞∞‡∞æ‡∞§‡±ç‡∞∞‡∞ø/‡∞™‡∞ó‡∞≤‡±Å">üåô</button>
    </div>
  </div>
</div>

<main>
  <!-- 1) Flash News -->
  <section class="card mb-4" id="section-flash">
    <div style="display:flex;align-items:center;gap:12px;">
      <div class="font-semibold telugu accent">üì¢ ‡∞§‡∞æ‡∞ú‡∞æ ‡∞µ‡∞æ‡∞∞‡±ç‡∞§‡∞≤‡±Å</div>
      <div id="flashTicker" class="ticker tiny telugu muted">‡∞≤‡±ã‡∞°‡±ç ‡∞Ö‡∞µ‡±Å‡∞§‡±Å‡∞Ç‡∞¶‡∞ø...</div>
    </div>
  </section>

  <!-- 2) Elders carousel -->
  <section class="card mb-4" id="section-elders">
    <h3 class="font-semibold telugu">‡∞ó‡±ç‡∞∞‡∞æ‡∞Æ ‡∞™‡±Ü‡∞¶‡±ç‡∞¶‡∞≤‡±Å (‡∞™‡±Ü‡∞¶‡±ç‡∞¶/‡∞Æ‡∞ß‡±ç‡∞Ø/‡∞ö‡∞ø‡∞®‡±ç‡∞®)</h3>

    <div class="carousel-wrap mt-3" id="eldersWrap">
      <div class="carousel-inner" id="eldersInner"></div>
    </div>

    <div style="display:flex;gap:8px;margin-top:10px;">
      <button id="prevE" class="btn telugu">‡∞Æ‡±Å‡∞Ç‡∞¶‡±Å‡∞ï‡±Å</button>
      <button id="nextE" class="btn telugu">‡∞§‡∞∞‡±ç‡∞µ‡∞æ‡∞§</button>
    </div>
  </section>

  <!-- 3) Basic info -->
  <section class="card mb-4" id="section-basic">
    <h3 class="font-semibold telugu">‡∞ó‡±ç‡∞∞‡∞æ‡∞Æ‡∞Ç ‚Äî ‡∞Æ‡±å‡∞≤‡∞ø‡∞ï ‡∞∏‡∞Æ‡∞æ‡∞ö‡∞æ‡∞∞‡∞Ç</h3>
    <div id="basicInfoContent" class="muted mt-2 telugu tiny">‡∞≤‡±ã‡∞°‡±ç ‡∞Ö‡∞µ‡±Å‡∞§‡±Å‡∞Ç‡∞¶‡∞ø...</div>
  </section>

  <!-- 4) Schemes placeholder -->
  <section class="card mb-4" id="section-schemes">
    <h4 class="font-semibold telugu">‡∞™‡∞•‡∞ï‡∞æ‡∞≤‡±Å</h4>
    <div class="muted mt-2 telugu tiny">‡∞™‡∞•‡∞ï‡∞æ‡∞≤ ‡∞µ‡∞ø‡∞µ‡∞∞‡∞æ‡∞≤ ‡∞ï‡±ã‡∞∏‡∞Ç ‡∞™‡∞•‡∞ï‡∞æ‡∞≤‡±Å ‡∞™‡±á‡∞ú‡±Ä ‡∞ö‡±Ç‡∞°‡∞Ç‡∞°‡∞ø.</div>
  </section>
</main>

<footer id="siteFooter">¬© ‡∞Æ‡±Å‡∞§‡±ç‡∞Ø‡∞æ‡∞≤‡∞≤‡±ã‡∞™‡±Å ‡∞ó‡±ç‡∞∞‡∞æ‡∞Æ‡∞Ç</footer>

<script>
/* Mobile menu open/close */
const mobileMenu = document.getElementById('mobileMenu');
function openMenu(){ mobileMenu.style.display='flex'; mobileMenu.setAttribute('aria-hidden','false'); }
function closeMenu(){ mobileMenu.style.display='none'; mobileMenu.setAttribute('aria-hidden','true'); }
document.getElementById('openMenuBtn').addEventListener('click', openMenu);

/* moon toggle in sidebar and page */
const moonToggleSidebar = document.getElementById('moonToggleSidebar');
function applyMoon(v){
  document.documentElement.classList.toggle('moon', v);
  localStorage.setItem('muthya_moon', v ? '1' : '0');
  // ensure toggles reflect state
  if(document.getElementById('moonToggleSidebar')) document.getElementById('moonToggleSidebar').textContent = v ? 'üåû' : 'üåô';
}
const stored = localStorage.getItem('muthya_moon') === '1';
applyMoon(stored);
if(document.getElementById('moonToggleSidebar')) document.getElementById('moonToggleSidebar').addEventListener('click', ()=> applyMoon(!document.documentElement.classList.contains('moon')));

/* CSV loader using PapaParse */
function loadCSV(path){
  return new Promise((resolve,reject)=>{
    Papa.parse(path, { download:true, header:true, skipEmptyLines:true,
      complete: (res)=> resolve(res.data), error: (err)=> reject(err)
    });
  });
}

/* FLASH */
async function renderFlash(){
  const el = document.getElementById('flashTicker');
  try{
    const rows = await loadCSV('Data/flash_news.csv');
    if(!rows || !rows.length) throw 'no';
    const parts = rows.map(r => {
      const d = r.date ? `[ ${r.date} ] ` : '';
      const title = r.title_tel || r.title || '';
      const desc = r.description_tel || r.description || '';
      return `${d}${title} ‚Äî ${desc}`;
    });
    const mover = document.createElement('div'); mover.className = 'ticker__move telugu tiny';
    mover.textContent = parts.join('   ‚ö´   ');
    el.innerHTML=''; el.appendChild(mover);
  }catch(e){ el.innerHTML = '<div class="muted telugu tiny">‡∞§‡∞æ‡∞ú‡∞æ ‡∞µ‡∞æ‡∞∞‡±ç‡∞§‡∞≤‡±Å ‡∞≤‡±á‡∞µ‡±Å</div>'; }
}

/* Basic info */
async function renderBasicInfo(){
  const el = document.getElementById('basicInfoContent');
  try{
    const rows = await loadCSV('Data/village_info.csv');
    const r = (rows && rows[0]) ? rows[0] : null;
    if(!r) throw 'no';
    const v_tel = r.village_name_tel || r.village_name_en || '‡∞Æ‡±Å‡∞§‡±ç‡∞Ø‡∞≤‡±ã‡∞™‡±Å';
    const mandal = r.mandal_tel || r.mandal || '';
    const district = r.district_tel || r.district || '';
    el.innerHTML = `
      <div><strong>‡∞ó‡±ç‡∞∞‡∞æ‡∞Æ‡∞Ç:</strong> ${v_tel}</div>
      <div><strong>‡∞Æ‡∞Ç‡∞°‡∞≤‡∞Ç:</strong> ${mandal || '‚Äî'}</div>
      <div><strong>‡∞ú‡∞ø‡∞≤‡±ç‡∞≤‡∞æ:</strong> ${district || '‚Äî'}</div>
      <div><strong>‡∞∏‡∞Ç‡∞ñ‡±ç‡∞Ø‡∞≤‡±Å:</strong> ‡∞ú‡∞®‡∞æ‡∞≠‡∞æ ${r.pop_total||'‚Äî'} (‡∞™‡±Å‡∞∞‡±Å‡∞∑‡±Å‡∞≤‡±Å ${r.pop_male||'‚Äî'}, ‡∞Æ‡∞π‡∞ø‡∞≥‡∞≤‡±Å ${r.pop_female||'‚Äî'})</div>
      <div><strong>‡∞á‡∞≥‡±ç‡∞≥ ‡∞∏‡∞Ç‡∞ñ‡±ç‡∞Ø:</strong> ${r.total_houses||'‚Äî'}</div>
    `;
  }catch(e){ el.innerHTML = '<div class="muted telugu tiny">‡∞ó‡±ç‡∞∞‡∞æ‡∞Æ ‡∞∏‡∞Æ‡∞æ‡∞ö‡∞æ‡∞∞‡∞Ç ‡∞Ö‡∞Ç‡∞¶‡±Å‡∞¨‡∞æ‡∞ü‡±Å‡∞≤‡±ã ‡∞≤‡±á‡∞¶‡±Å.</div>'; }
}

/* Elders carousel */
let eidx = 0, elders = [];
async function renderElders(){
  try{ elders = await loadCSV('Data/village_peddalu.csv'); } catch(e){ elders = []; }
  const inner = document.getElementById('eldersInner');
  if(!elders.length){ inner.innerHTML = '<div class="carousel-card card telugu tiny">‡∞ó‡±ç‡∞∞‡∞æ‡∞Æ ‡∞™‡±Ü‡∞¶‡±ç‡∞¶‡∞≤ ‡∞µ‡∞ø‡∞µ‡∞∞‡∞æ‡∞≤‡±Å ‡∞≤‡±á‡∞µ‡±Å</div>'; return; }

  inner.innerHTML = elders.map(it=>{
    const role = it.role_tel || it.role || '';
    const name = it.name_tel || it.name || '';
    const note = it.note_tel || it.note || '';
    const photo = it.photo_url || it.photo || 'images/pedda.jpg';
    return `<div class="carousel-card card">
      <div style="display:flex;gap:12px;align-items:center;">
        <div style="width:84px;height:84px;border-radius:9999px;overflow:hidden;background:#f3f4f6;">
          <img src="${photo}" alt="${name}" style="width:100%;height:100%;object-fit:cover;" onerror="this.src='images/pedda.jpg'">
        </div>
        <div>
          <div class="font-semibold telugu">${role}</div>
          <div class="text-lg font-bold telugu">${name}</div>
          <div class="muted telugu tiny mt-1">${note}</div>
        </div>
      </div>
    </div>`;
  }).join('');

  function updatePos(){ const translatePercent = eidx * 100; document.getElementById('eldersInner').style.transform = `translateX(-${translatePercent}%)`; }
  document.getElementById('prevE').onclick = ()=> { eidx = (eidx - 1 + elders.length) % elders.length; updatePos(); resetAuto(); };
  document.getElementById('nextE').onclick = ()=> { eidx = (eidx + 1) % elders.length; updatePos(); resetAuto(); };

  // touch support
  let sx=0, cx=0, touching=false;
  inner.addEventListener('touchstart', e => { sx = e.touches[0].clientX; touching=true; });
  inner.addEventListener('touchmove', e => { if(!touching) return; cx = e.touches[0].clientX; });
  inner.addEventListener('touchend', e => {
    if(!touching) return; const diff = sx - cx;
    if(Math.abs(diff) > 35){ if(diff > 0) eidx = (eidx + 1) % elders.length; else eidx = (eidx - 1 + elders.length) % elders.length; updatePos(); }
    touching=false; sx=cx=0; resetAuto();
  });

  // autoplay
  let t = setInterval(()=> { eidx = (eidx + 1) % elders.length; updatePos(); }, 4500);
  function resetAuto(){ clearInterval(t); t = setInterval(()=> { eidx = (eidx + 1) % elders.length; updatePos(); }, 4500); }
  updatePos();
  window.addEventListener('resize', updatePos);
}

/* init */
renderFlash();
renderBasicInfo();
renderElders();

</script>
</body>
</html>
