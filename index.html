<!doctype html>
<html lang="te">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>‡∞Æ‡±Å‡∞§‡±ç‡∞Ø‡∞æ‡∞≤‡±ã‡∞™‡±Å ‡∞ó‡±ç‡∞∞‡∞æ‡∞Æ‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞∏‡±ç‡∞µ‡∞æ‡∞ó‡∞§‡∞Ç</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- PapaParse for CSV -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <style>
    :root{
      --bg: #f8fafc; --card:#fff; --muted:#6b7280; --accent:#f97316; --text:#0f172a;
    }
    .moon {
      --bg: #07102a; --card: rgba(255,255,255,0.04); --muted:#cbd5e1; --accent:#fb923c; --text:#e6f0ff;
    }

    html,body{ height:100%; }
    body{
      margin:0; padding:0;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: var(--bg); color: var(--text);
      transition: background .18s, color .18s;
    }

    /* Header fixed - prevent overlap by giving main padding-top */
    header{
      position: fixed; left:0; right:0; top:0; z-index:50;
      background: var(--card);
      box-shadow: 0 2px 6px rgba(2,6,23,0.06);
      backdrop-filter: blur(4px);
    }

    main{ max-width:1100px; margin:0 auto; padding:88px 16px 32px; } /* 88px to avoid header overlap */

    .card{ background: var(--card); border-radius:10px; padding:14px; box-shadow:0 1px 4px rgba(2,6,23,0.04); }

    .muted { color: var(--muted); }
    .accent { color: var(--accent); }
    a.link { color: var(--accent); text-decoration: none; }

    /* Flash ticker */
    .ticker { white-space: nowrap; overflow: hidden; }
    .ticker__move { display:inline-block; padding-left:100%; animation: ticker 55s linear infinite; }
    @keyframes ticker { 0% { transform: translateX(0);} 100% { transform: translateX(-100%);} }

    /* Header layout adjustments */
    .hdr-left { display:flex; gap:10px; align-items:center; min-width:0; }
    .hdr-title { display:flex; flex-direction:column; line-height:1.05; min-width:0; }
    .hdr-title .title-main { font-weight:700; font-size:1rem; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .hdr-title .title-sub { font-size:0.75rem; color:var(--muted); }

    /* Responsive: desktop shows modules inline, mobile shows menu icon */
    .modules { display:none; }
    .menu-btn { display:flex; align-items:center; gap:8px; }

    @media(min-width:768px){
      main{ padding-top:108px; }
      .hdr-title .title-main { font-size:1.35rem; }
      .modules { display:flex; gap:10px; align-items:center; }
      .menu-btn { display:none; }
    }

    /* Mobile menu (full-screen slide) */
    #mobileMenu {
      position: fixed; inset:0; z-index:60; display:none; align-items:flex-start; justify-content:flex-end;
    }
    #mobileMenu .backdrop { position:absolute; inset:0; background:rgba(0,0,0,0.45); }
    #mobileMenu .panel { position:relative; width:84%; max-width:320px; background:var(--card); height:100%; padding:16px; overflow:auto; box-shadow: -8px 0 20px rgba(2,6,23,0.12); }

    /* ensure avatar images small and circular */
    .avatar-sm { width:36px; height:36px; border-radius:9999px; object-fit:cover; }

    /* small tweaks */
    .tiny { font-size:0.8rem; }
    .btn { padding:8px 12px; border-radius:8px; background:#f3f4f6; cursor:pointer; }
    .btn:hover{ background:#eceff1; }

  </style>
</head>

<body id="body">
  <!-- HEADER -->
  <header>
    <div class="max-w-6xl mx-auto flex items-center justify-between gap-3 p-3">
      <!-- Left: logo + title -->
      <div class="hdr-left">
        <img src="images/logo.png" alt="logo" class="w-10 h-10 rounded-full object-cover" onerror="this.style.display='none'">
        <div class="hdr-title min-w-0">
          <div class="title-main telugu">‡∞Æ‡±Å‡∞§‡±ç‡∞Ø‡∞æ‡∞≤‡∞≤‡±ã‡∞™‡±Å ‡∞ó‡±ç‡∞∞‡∞æ‡∞Æ‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞∏‡±ç‡∞µ‡∞æ‡∞ó‡∞§‡∞Ç</div>
          <div class="title-sub telugu">‡∞Æ‡∞® ‡∞ä‡∞∞‡∞ø ‡∞∏‡∞Æ‡∞æ‡∞ö‡∞æ‡∞∞‡∞Ç ‚Äî ‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</div>
        </div>
      </div>

      <!-- Right: desktop modules or mobile menu icon -->
      <div class="flex items-center gap-3">
        <!-- Desktop modules -->
        <nav class="modules">
          <a href="about.html" class="px-3 py-2 rounded card telugu tiny">‡∞ó‡±ç‡∞∞‡∞æ‡∞Æ‡∞Ç ‡∞ó‡±Å‡∞∞‡∞ø‡∞Ç‡∞ö‡∞ø</a>
          <a href="schemes.html" class="px-3 py-2 rounded card telugu tiny">‡∞™‡∞•‡∞ï‡∞æ‡∞≤‡±Å</a>
          <a href="admin.html" class="px-3 py-2 rounded card telugu tiny">‡∞®‡∞ø‡∞∞‡±ç‡∞µ‡∞æ‡∞π‡∞ï‡±Å‡∞≤‡±Å</a>
        </nav>

        <!-- Mobile: small avatars (optional) + menu button -->
        <div class="menu-btn items-center">
          <!-- small avatars (if you want) - optional -->
          <img src="images/pedda.jpg" alt="" class="avatar-sm" onerror="this.style.display='none'">
          <button id="openMenu" class="btn" aria-label="‡∞Æ‡±Ü‡∞®‡±Å ‡∞§‡±Ü‡∞∞‡±Å‡∞µ‡±Å">‚ò∞</button>
        </div>
      </div>
    </div>
  </header>

  <!-- MOBILE MENU PANEL -->
  <div id="mobileMenu" aria-hidden="true">
    <div class="backdrop" onclick="closeMenu()"></div>
    <div class="panel">
      <div class="flex items-center justify-between mb-4">
        <div class="flex items-center gap-3">
          <img src="images/logo.png" alt="logo" class="w-12 h-12 rounded-full object-cover" onerror="this.style.display='none'">
          <div>
            <div class="font-semibold telugu">‡∞Æ‡±Å‡∞§‡±ç‡∞Ø‡∞æ‡∞≤‡∞≤‡±ã‡∞™‡±Å</div>
            <div class="tiny muted telugu">‡∞Æ‡±Ü‡∞®‡±Ç</div>
          </div>
        </div>
        <button onclick="closeMenu()" class="btn">‚úï</button>
      </div>

      <nav class="space-y-2">
        <a href="about.html" class="block p-3 rounded card telugu">‡∞ó‡±ç‡∞∞‡∞æ‡∞Æ‡∞Ç ‡∞ó‡±Å‡∞∞‡∞ø‡∞Ç‡∞ö‡∞ø</a>
        <a href="schemes.html" class="block p-3 rounded card telugu">‡∞™‡∞•‡∞ï‡∞æ‡∞≤‡±Å</a>
        <a href="admin.html" class="block p-3 rounded card telugu">‡∞®‡∞ø‡∞∞‡±ç‡∞µ‡∞æ‡∞π‡∞ï‡±Å‡∞≤‡±Å</a>
      </nav>

      <div class="mt-6">
        <div class="text-xs muted telugu mb-2">‡∞≠‡∞æ‡∞∑:</div>
        <div class="flex gap-2">
          <button class="btn telugu" disabled>‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</button>
        </div>
      </div>

      <div class="mt-6 tiny muted telugu">¬© Muthyalathopu Village</div>
    </div>
  </div>

  <!-- MAIN (content) -->
  <main>

    <!-- Flash News -->
    <section class="card mb-4">
      <div class="flex items-center gap-3">
        <div class="font-semibold telugu accent">üì¢ ‡∞§‡∞æ‡∞ú‡∞æ ‡∞µ‡∞æ‡∞∞‡±ç‡∞§‡∞≤‡±Å</div>
        <div id="flashTicker" class="flex-1 ticker telugu muted tiny">‡∞≤‡±ã‡∞°‡±ç ‡∞Ö‡∞µ‡±Å‡∞§‡±Å‡∞Ç‡∞¶‡∞ø...</div>
      </div>
    </section>

    <!-- Basic Info (immediately under header as requested) -->
    <section id="basic" class="card mb-4">
      <h3 class="font-semibold telugu">‡∞ó‡±ç‡∞∞‡∞æ‡∞Æ‡∞Ç ‚Äî ‡∞Æ‡±å‡∞≤‡∞ø‡∞ï ‡∞∏‡∞Æ‡∞æ‡∞ö‡∞æ‡∞∞‡∞Ç</h3>
      <div id="basicInfoContent" class="muted mt-2 telugu tiny">‡∞≤‡±ã‡∞°‡±ç ‡∞Ö‡∞µ‡±Å‡∞§‡±Å‡∞Ç‡∞¶‡∞ø...</div>
    </section>

    <!-- Water & Electricity and Helpline -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
      <div class="card">
        <h4 class="font-semibold telugu">‡∞®‡±Ä‡∞∞‡±Å & ‡∞µ‡∞ø‡∞¶‡±ç‡∞Ø‡±Å‡∞§‡±ç ‡∞∏‡∞Æ‡∞æ‡∞ö‡∞æ‡∞∞‡∞Ç</h4>
        <div id="waterContent" class="muted mt-2 telugu tiny">‡∞≤‡±ã‡∞°‡±ç ‡∞Ö‡∞µ‡±Å‡∞§‡±Å‡∞Ç‡∞¶‡∞ø...</div>
      </div>

      <div class="card">
        <h4 class="font-semibold telugu">‡∞Ö‡∞§‡±ç‡∞Ø‡∞æ‡∞µ‡∞∂‡±ç‡∞Ø‡∞ï ‡∞∏‡∞π‡∞æ‡∞Ø‡∞Ç & ‡∞π‡±Ü‡∞≤‡±ç‡∞™‡±ç‚Äå‡∞≤‡±à‡∞®‡±ç</h4>
        <div id="helplineContent" class="muted mt-2 telugu tiny">‡∞≤‡±ã‡∞°‡±ç ‡∞Ö‡∞µ‡±Å‡∞§‡±Å‡∞Ç‡∞¶‡∞ø...</div>
      </div>
    </div>

    <!-- Peddalu carousel + Sachivalayam card -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
      <div class="md:col-span-2 card">
        <h4 class="font-semibold telugu">‡∞ó‡±ç‡∞∞‡∞æ‡∞Æ ‡∞™‡±Ü‡∞¶‡±ç‡∞¶‡∞≤‡±Å (‡∞™‡±Ü‡∞¶‡±ç‡∞¶/‡∞Æ‡∞ß‡±ç‡∞Ø/‡∞ö‡∞ø‡∞®‡±ç‡∞®)</h4>
        <div id="peddaluCarousel" class="mt-3"></div>
        <div class="flex gap-2 mt-3">
          <button id="prevP" class="btn telugu">‡∞Æ‡±Å‡∞Ç‡∞¶‡±Å‡∞ï‡±Å</button>
          <button id="nextP" class="btn telugu">‡∞§‡∞∞‡±ç‡∞µ‡∞æ‡∞§</button>
        </div>
      </div>

      <div class="card">
        <h4 class="font-semibold telugu">‡∞∏‡∞ö‡∞ø‡∞µ‡∞æ‡∞≤‡∞Ø‡∞Ç ‡∞∏‡∞Æ‡∞æ‡∞ö‡∞æ‡∞∞‡∞Ç</h4>
        <div id="sachivalayamCard" class="mt-2 telugu tiny">
          <div><strong>‡∞∏‡∞ö‡∞ø‡∞µ‡∞æ‡∞≤‡∞Ø ‡∞Ö‡∞ß‡∞ø‡∞ï‡∞æ‡∞∞‡∞ø:</strong> <span id="secName">‡∞é‡∞Ç. ‡∞∏‡±Ä‡∞§‡∞æ‡∞∞‡∞æ‡∞Ç</span></div>
          <div>‡∞´‡±ã‡∞®‡±ç: <a id="secPhone" class="link" href="tel:+919876543210">+91 98765 43210</a></div>
          <div class="mt-2"><strong>VRO:</strong> <span id="vroName">‡∞¨‡∞ø. ‡∞∞‡∞µ‡∞ø‡∞ï‡∞æ‡∞Ç‡∞§‡±ç</span></div>
          <div>‡∞´‡±ã‡∞®‡±ç: <a id="vroPhone" class="link" href="tel:+919988766554">+91 99887 66554</a></div>
        </div>
      </div>
    </div>

    <!-- Schemes summary placeholder -->
    <section class="card mb-4">
      <h4 class="font-semibold telugu">‡∞™‡∞•‡∞ï‡∞æ‡∞≤‡±Å</h4>
      <div class="muted mt-2 telugu tiny">‡∞™‡∞•‡∞ï‡∞æ‡∞≤ ‡∞∏‡∞Æ‡∞∞‡±Ä ‡∞ï‡±ã‡∞∏‡∞Ç Schemes ‡∞™‡±á‡∞ú‡±Ä ‡∞ö‡±Ç‡∞°‡∞Ç‡∞°‡∞ø.</div>
    </section>

    <footer class="text-center muted tiny telugu mt-6">¬© ‡∞Æ‡±Å‡∞§‡±ç‡∞Ø‡∞æ‡∞≤‡∞≤‡±ã‡∞™‡±Å ‡∞ó‡±ç‡∞∞‡∞æ‡∞Æ‡∞Ç</footer>
  </main>

<script>
/* Mobile menu open/close */
const mobileMenu = document.getElementById('mobileMenu');
function openMenu(){ mobileMenu.style.display='flex'; mobileMenu.setAttribute('aria-hidden','false'); }
function closeMenu(){ mobileMenu.style.display='none'; mobileMenu.setAttribute('aria-hidden','true'); }
document.getElementById('openMenu').addEventListener('click', openMenu);

/* Theme toggle (remembered) */
(function(){
  const stored = localStorage.getItem('muthya_moon') === '1';
  if(stored) document.documentElement.classList.add('moon');
  // optional: add small theme control here if needed
})();

/* CSV loader using PapaParse */
function loadCSV(path){
  return new Promise((resolve,reject)=>{
    Papa.parse(path, { download:true, header:true, skipEmptyLines:true,
      complete: (res)=> resolve(res.data), error: (err)=> reject(err)
    });
  });
}

/* FLASH NEWS: Telugu */
async function renderFlash(){
  const el = document.getElementById('flashTicker');
  try{
    const data = await loadCSV('Data/flash_news.csv');
    if(!data || !data.length) throw 'no';
    const parts = data.map(it => {
      const d = it.date ? `[ ${it.date} ] ` : '';
      return `${d}${it.title || ''} ‚Äî ${it.description || ''}`;
    });
    const mover = document.createElement('div'); mover.className = 'ticker__move telugu tiny';
    mover.textContent = parts.join('   ‚ö´   ');
    el.innerHTML = ''; el.appendChild(mover);
  }catch(e){
    el.innerHTML = '<div class="telugu muted tiny">‡∞§‡∞æ‡∞ú‡∞æ ‡∞µ‡∞æ‡∞∞‡±ç‡∞§‡∞≤‡±Å ‡∞≤‡±á‡∞µ‡±Å</div>';
  }
}

/* BASIC INFO */
async function renderBasicInfo(){
  const el = document.getElementById('basicInfoContent');
  try{
    const rows = await loadCSV('Data/village_info.csv');
    const r = rows && rows[0] ? rows[0] : null;
    if(!r) throw 'no';
    el.innerHTML = `
      <div><strong>‡∞ó‡±ç‡∞∞‡∞æ‡∞Æ‡∞Ç:</strong> ${r.village_name_tel || r.village_name_en || '‚Äî' } ${r.village_name_en ? '('+r.village_name_en+')' : ''}</div>
      <div><strong>‡∞Æ‡∞Ç‡∞°‡∞≤‡∞Ç:</strong> ${r.mandal || '‚Äî'}</div>
      <div><strong>‡∞ú‡∞ø‡∞≤‡±ç‡∞≤‡∞æ:</strong> ${r.district || '‚Äî'}</div>
      <div><strong>‡∞∏‡∞Ç‡∞ñ‡±ç‡∞Ø‡∞≤‡±Å:</strong> ‡∞ú‡∞®‡∞æ‡∞≠‡∞æ ‡∞Æ‡±ä‡∞§‡±ç‡∞§‡∞Ç ${r.pop_total || '‚Äî'} (‡∞™‡±Å‡∞∞‡±Å‡∞∑‡±Å‡∞≤‡±Å ${r.pop_male || '‚Äî'}, ‡∞Æ‡∞π‡∞ø‡∞≥‡∞≤‡±Å ${r.pop_female || '‚Äî'})</div>
      <div><strong>‡∞á‡∞≥‡±ç‡∞≥ ‡∞∏‡∞Ç‡∞ñ‡±ç‡∞Ø:</strong> ${r.total_houses || '‚Äî'}</div>
      <div><strong>‡∞™‡±ç‡∞∞‡∞ß‡∞æ‡∞® ‡∞ï‡∞æ‡∞∞‡±ç‡∞Ø‡∞ï‡∞≤‡∞æ‡∞™‡∞æ‡∞≤‡±Å:</strong> ${r.main_occupations || '‚Äî'}</div>
    `;
  }catch(e){
    el.innerHTML = `<div class="muted telugu tiny">Village info ‡∞Ö‡∞Ç‡∞¶‡±Å‡∞¨‡∞æ‡∞ü‡±Å‡∞≤‡±ã ‡∞≤‡±á‡∞¶‡±Å. Data/village_info.csv ‡∞®‡∞ø ‡∞∏‡±Ü‡∞ü‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø.</div>`;
  }
}

/* WATER & ELECTRICITY */
async function renderWater(){
  const el = document.getElementById('waterContent');
  try{
    const rows = await loadCSV('Data/water_elec.csv');
    if(!rows || !rows.length) throw 'no';
    let html = '';
    rows.forEach(r => html += `<div><strong>${r.type||'‚Äî'}:</strong> ${r.detail||'‚Äî'}</div>`);
    el.innerHTML = html;
  }catch(e){
    el.innerHTML = '<div class="muted telugu tiny">‡∞®‡±Ä‡∞∞‡±Å/‡∞µ‡∞ø‡∞¶‡±ç‡∞Ø‡±Å‡∞§‡±ç ‡∞µ‡∞ø‡∞µ‡∞∞‡∞æ‡∞≤‡±Å ‡∞≤‡±á‡∞µ‡±Å</div>';
  }
}

/* HELPLINE */
async function renderHelpline(){
  const el = document.getElementById('helplineContent');
  try{
    const rows = await loadCSV('Data/helpline.csv');
    if(!rows || !rows.length) throw 'no';
    let html = '<ul class="list-disc pl-5">';
    rows.forEach(r => html += `<li class="telugu tiny"><strong>${r.role || r.name || '‚Äî'}:</strong> <a class="link" href="tel:${r.phone||''}">${r.phone||'‚Äî'}</a></li>`);
    html += '</ul>';
    el.innerHTML = html;
  }catch(e){
    el.innerHTML = '<div class="muted telugu tiny">‡∞π‡±Ü‡∞≤‡±ç‡∞™‡±ç‚Äå‡∞≤‡±à‡∞®‡±ç ‡∞∏‡∞Æ‡∞æ‡∞ö‡∞æ‡∞∞‡∞Ç ‡∞≤‡±á‡∞¶‡±Å</div>';
  }
}

/* PEDDALU CAROUSEL (role + name + note + photo) */
let pidx = 0, pslides = [];
async function renderPeddalu(){
  const wrap = document.getElementById('peddaluCarousel');
  try{ const rows = await loadCSV('Data/village_peddalu.csv'); pslides = rows || []; } catch(e){ pslides = []; }
  if(!pslides.length){ wrap.innerHTML = '<div class="muted telugu tiny p-4">‡∞™‡±Ü‡∞¶‡±ç‡∞¶‡∞≤ ‡∞µ‡∞ø‡∞µ‡∞∞‡∞æ‡∞≤‡±Å ‡∞≤‡±á‡∞µ‡±Å</div>'; return; }

  function show(i){
    pidx = (i + pslides.length) % pslides.length;
    const it = pslides[pidx];
    wrap.innerHTML = `
      <div class="flex items-center gap-3">
        <div class="w-20 h-20 rounded-full overflow-hidden bg-gray-100"><img src="${it.photo_url||'images/pedda.jpg'}" alt="${it.name||''}" class="w-full h-full object-cover"></div>
        <div>
          <div class="font-semibold telugu">${it.role||''}</div>
          <div class="text-lg font-bold telugu">${it.name||''}</div>
          <div class="muted telugu tiny mt-1">${it.note||''}</div>
        </div>
      </div>
    `;
  }

  document.getElementById('prevP').onclick = ()=> { show(pidx-1); };
  document.getElementById('nextP').onclick = ()=> { show(pidx+1); };
  show(0);
}

/* Sachivalayam static fill (you can make dynamic CSV if needed) */
function fillSachivalayam(){
  document.getElementById('secName').textContent = '‡∞é‡∞Ç. ‡∞∏‡±Ä‡∞§‡∞æ‡∞∞‡∞æ‡∞Ç';
  const secPhone = document.getElementById('secPhone'); secPhone.textContent = '+91 98765 43210'; secPhone.href='tel:+919876543210';
  document.getElementById('vroName').textContent = '‡∞¨‡∞ø. ‡∞∞‡∞µ‡∞ø‡∞ï‡∞æ‡∞Ç‡∞§‡±ç';
  const vroPhone = document.getElementById('vroPhone'); vroPhone.textContent = '+91 99887 66554'; vroPhone.href='tel:+919988766554';
}

/* INIT */
renderFlash();
renderBasicInfo();
renderWater();
renderHelpline();
renderPeddalu();
fillSachivalayam();

</script>
</body>
</html>
