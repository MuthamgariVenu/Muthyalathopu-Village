<!doctype html>
<html lang="te">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>‡∞Æ‡±Å‡∞§‡±ç‡∞Ø‡∞æ‡∞≤‡∞≤‡±ã‡∞™‡±Å ‚Äî ‡∞°‡∞æ‡∞∑‡±ç‚Äå‡∞¨‡±ã‡∞∞‡±ç‡∞°‡±ç</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <style>
    :root{ --bg:#f8fafc; --card:#fff; --muted:#6b7280; --accent:#f97316; --text:#0f172a; }
    .moon{ --bg:#07102a; --card:rgba(255,255,255,0.04); --muted:#cbd5e1; --accent:#fb923c; --text:#e6f0ff; }

    html,body{height:100%; margin:0; font-family: ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Arial;}
    body{ background:var(--bg); color:var(--text); transition:.18s; }

    header{ position:fixed; top:0; left:0; right:0; z-index:50; background:var(--card); box-shadow:0 2px 6px rgba(2,6,23,0.06); }
    .hdr{ max-width:1100px; margin:0 auto; display:flex; align-items:center; justify-content:space-between; padding:10px 14px; gap:12px; }
    .logo{ width:44px; height:44px; border-radius:8px; object-fit:cover; }
    .title-main{ font-weight:700; font-size:1rem; }
    .title-sub{ font-size:0.78rem; color:var(--muted); }

    .modules{ display:none; gap:10px; }
    @media(min-width:768px){ .modules{ display:flex; } .title-main{ font-size:1.2rem; } .hdr{ padding:14px 18px; } }

    main{ max-width:1100px; margin:0 auto; padding:92px 14px 28px; }

    .card{ background:var(--card); border-radius:10px; padding:14px; box-shadow:0 1px 4px rgba(2,6,23,0.04); }
    .muted{ color:var(--muted); }
    .accent{ color:var(--accent); }
    a.link{ color:var(--accent); text-decoration:none; }

    .ticker{ white-space:nowrap; overflow:hidden; }
    .ticker__move{ display:inline-block; padding-left:100%; animation:ticker 55s linear infinite; }
    @keyframes ticker{ 0%{ transform:translateX(0);}100%{ transform:translateX(-100%);} }

    /* mobile menu */
    #mobileMenu{ position:fixed; inset:0; z-index:60; display:none; align-items:flex-start; justify-content:flex-end; }
    #mobileMenu .backdrop{ position:absolute; inset:0; background:rgba(0,0,0,0.45); }
    #mobileMenu .panel{ position:relative; width:84%; max-width:320px; background:var(--card); height:100%; padding:16px; overflow:auto; box-shadow:-8px 0 20px rgba(2,6,23,0.12); }

    .btn{ padding:8px 12px; border-radius:8px; background:#f3f4f6; cursor:pointer; border:1px solid rgba(2,6,23,0.03); }
    .tiny{ font-size:0.88rem; }
    .toggle-small{ padding:6px; border-radius:8px; font-size:16px; }
  </style>
</head>
<body id="body">

<header>
  <div class="hdr">
    <div style="display:flex;gap:10px;align-items:center;min-width:0;">
      <img src="images/logo.png" alt="‡∞≤‡∞æ‡∞ó‡±ã" class="logo" onerror="this.style.display='none'">
      <div style="min-width:0;">
        <div class="title-main telugu">‡∞Æ‡±Å‡∞§‡±ç‡∞Ø‡∞æ‡∞≤‡∞≤‡±ã‡∞™‡±Å ‡∞ó‡±ç‡∞∞‡∞æ‡∞Æ‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞∏‡±ç‡∞µ‡∞æ‡∞ó‡∞§‡∞Ç</div>
        <div class="title-sub telugu">‡∞Æ‡∞® ‡∞ä‡∞∞‡∞ø ‡∞∏‡∞Æ‡∞æ‡∞ö‡∞æ‡∞∞‡∞Ç ‚Äî ‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</div>
      </div>
    </div>

    <div style="display:flex;align-items:center;gap:8px;">
      <!-- desktop modules -->
      <nav class="modules">
        <a href="about.html" class="btn telugu tiny">‡∞ó‡±ç‡∞∞‡∞æ‡∞Æ‡∞Ç ‡∞ó‡±Å‡∞∞‡∞ø‡∞Ç‡∞ö‡∞ø</a>
        <a href="schemes.html" class="btn telugu tiny">‡∞™‡∞•‡∞ï‡∞æ‡∞≤‡±Å</a>
        <a href="admin.html" class="btn telugu tiny">‡∞®‡∞ø‡∞∞‡±ç‡∞µ‡∞æ‡∞π‡∞ï‡±Å‡∞≤‡±Å</a>
      </nav>

      <!-- mobile hamburger -->
      <button id="openMenuBtn" class="btn md:hidden" aria-label="‡∞Æ‡±Ü‡∞®‡±Ç">‚ò∞</button>
    </div>
  </div>
</header>

<!-- mobile menu -->
<div id="mobileMenu" aria-hidden="true">
  <div class="backdrop" onclick="closeMenu()"></div>
  <div class="panel">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;">
      <div style="display:flex;gap:10px;align-items:center;">
        <img src="images/logo.png" alt="logo" class="logo" onerror="this.style.display='none'">
        <div>
          <div class="font-semibold telugu">‡∞Æ‡±Å‡∞§‡±ç‡∞Ø‡∞æ‡∞≤‡∞≤‡±ã‡∞™‡±Å</div>
          <div class="tiny muted telugu">‡∞Æ‡±Ü‡∞®‡±Ç</div>
        </div>
      </div>
      <button onclick="closeMenu()" class="btn">‚úï</button>
    </div>

    <nav class="space-y-3">
      <a href="about.html" class="block p-3 rounded card telugu">‡∞ó‡±ç‡∞∞‡∞æ‡∞Æ‡∞Ç ‡∞ó‡±Å‡∞∞‡∞ø‡∞Ç‡∞ö‡∞ø</a>
      <a href="schemes.html" class="block p-3 rounded card telugu">‡∞™‡∞•‡∞ï‡∞æ‡∞≤‡±Å</a>
      <a href="admin.html" class="block p-3 rounded card telugu">‡∞®‡∞ø‡∞∞‡±ç‡∞µ‡∞æ‡∞π‡∞ï‡±Å‡∞≤‡±Å</a>
    </nav>

    <div style="margin-top:18px; display:flex; align-items:center; justify-content:space-between;">
      <div class="tiny muted telugu">‡∞≠‡∞æ‡∞∑: ‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</div>
      <!-- small moonlight toggle in sidebar -->
      <button id="moonToggleSidebar" class="toggle-small" title="‡∞∞‡∞æ‡∞§‡±ç‡∞∞‡∞ø/‡∞™‡∞ó‡∞≤‡±Å">üåô</button>
    </div>

  </div>
</div>

<main>
  <!-- Flash -->
  <section class="card mb-4">
    <div style="display:flex;align-items:center;gap:12px;">
      <div class="font-semibold telugu accent">üì¢ ‡∞§‡∞æ‡∞ú‡∞æ ‡∞µ‡∞æ‡∞∞‡±ç‡∞§‡∞≤‡±Å</div>
      <div id="flashTicker" class="ticker tiny telugu muted">‡∞≤‡±ã‡∞°‡±ç ‡∞Ö‡∞µ‡±Å‡∞§‡±Å‡∞Ç‡∞¶‡∞ø...</div>
    </div>
  </section>

  <!-- Basic info -->
  <section class="card mb-4">
    <h3 class="font-semibold telugu">‡∞ó‡±ç‡∞∞‡∞æ‡∞Æ‡∞Ç ‚Äî ‡∞Æ‡±å‡∞≤‡∞ø‡∞ï ‡∞∏‡∞Æ‡∞æ‡∞ö‡∞æ‡∞∞‡∞Ç</h3>
    <div id="basicInfoContent" class="muted mt-2 telugu tiny">‡∞≤‡±ã‡∞°‡±ç ‡∞Ö‡∞µ‡±Å‡∞§‡±Å‡∞Ç‡∞¶‡∞ø...</div>
  </section>

  <!-- Water & Helpline -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
    <div class="card">
      <h4 class="font-semibold telugu">‡∞®‡±Ä‡∞∞‡±Å & ‡∞µ‡∞ø‡∞¶‡±ç‡∞Ø‡±Å‡∞§‡±ç ‡∞∏‡∞Æ‡∞æ‡∞ö‡∞æ‡∞∞‡∞Ç</h4>
      <div id="waterContent" class="muted mt-2 telugu tiny">‡∞≤‡±ã‡∞°‡±ç ‡∞Ö‡∞µ‡±Å‡∞§‡±Å‡∞Ç‡∞¶‡∞ø...</div>
    </div>
    <div class="card">
      <h4 class="font-semibold telugu">‡∞Ö‡∞§‡±ç‡∞Ø‡∞æ‡∞µ‡∞∂‡±ç‡∞Ø‡∞ï ‡∞∏‡∞π‡∞æ‡∞Ø‡∞Ç & ‡∞π‡±Ü‡∞≤‡±ç‡∞™‡±ç‚Äå‡∞≤‡±à‡∞®‡±ç</h4>
      <div id="helplineContent" class="muted mt-2 telugu tiny">‡∞≤‡±ã‡∞°‡±ç ‡∞Ö‡∞µ‡±Å‡∞§‡±Å‡∞Ç‡∞¶‡∞ø...</div>
    </div>
  </div>

  <!-- Schemes placeholder -->
  <section class="card mb-4">
    <h4 class="font-semibold telugu">‡∞™‡∞•‡∞ï‡∞æ‡∞≤‡±Å</h4>
    <div class="muted mt-2 telugu tiny">‡∞™‡∞•‡∞ï‡∞æ‡∞≤ ‡∞µ‡∞ø‡∞µ‡∞∞‡∞æ‡∞≤ ‡∞ï‡±ã‡∞∏‡∞Ç "‡∞™‡∞•‡∞ï‡∞æ‡∞≤‡±Å" ‡∞™‡±á‡∞ú‡±Ä ‡∞ö‡±Ç‡∞°‡∞Ç‡∞°‡∞ø.</div>
  </section>

  <footer class="text-center muted tiny telugu mt-6">¬© ‡∞Æ‡±Å‡∞§‡±ç‡∞Ø‡∞æ‡∞≤‡∞≤‡±ã‡∞™‡±Å ‡∞ó‡±ç‡∞∞‡∞æ‡∞Æ‡∞Ç</footer>
</main>

<script>
/* mobile menu open/close */
const mobileMenu = document.getElementById('mobileMenu');
function openMenu(){ mobileMenu.style.display='flex'; mobileMenu.setAttribute('aria-hidden','false'); }
function closeMenu(){ mobileMenu.style.display='none'; mobileMenu.setAttribute('aria-hidden','true'); }
document.getElementById('openMenuBtn').addEventListener('click', openMenu);

/* moon toggle in sidebar */
const moonToggleSidebar = document.getElementById('moonToggleSidebar');
function applyMoon(v){ document.documentElement.classList.toggle('moon', v); localStorage.setItem('muthya_moon', v ? '1':'0'); moonToggleSidebar.textContent = v ? 'üåû':'üåô'; }
const stored = localStorage.getItem('muthya_moon') === '1';
applyMoon(stored);
moonToggleSidebar.addEventListener('click', ()=> applyMoon(!document.documentElement.classList.contains('moon')));

/* CSV loader */
function loadCSV(path){
  return new Promise((res,rej)=> {
    Papa.parse(path, { download:true, header:true, skipEmptyLines:true, complete: r=> res(r.data), error: e=> rej(e) });
  });
}

/* Flash */
async function renderFlash(){
  const el = document.getElementById('flashTicker');
  try{
    const rows = await loadCSV('Data/flash_news.csv');
    if(!rows || !rows.length) throw 'no';
    const parts = rows.map(r => {
      const d = r.date ? `[ ${r.date} ] ` : '';
      const title = r.title_tel || r.title || '';
      const desc = r.description_tel || r.description || '';
      return `${d}${title} ‚Äî ${desc}`;
    });
    const m = document.createElement('div'); m.className = 'ticker__move telugu tiny';
    m.textContent = parts.join('   ‚ö´   ');
    el.innerHTML=''; el.appendChild(m);
  }catch(e){
    el.innerHTML = '<div class="muted telugu tiny">‡∞§‡∞æ‡∞ú‡∞æ ‡∞µ‡∞æ‡∞∞‡±ç‡∞§‡∞≤‡±Å ‡∞≤‡±á‡∞µ‡±Å</div>';
  }
}

/* Basic info */
async function renderBasicInfo(){
  const el = document.getElementById('basicInfoContent');
  try{
    const rows = await loadCSV('Data/village_info.csv');
    const r = rows && rows[0] ? rows[0] : null;
    if(!r) throw 'no';
    const v_tel = r.village_name_tel || r.village_name_en || '';
    const mandal = (r.mandal_tel || r.mandal) ? (r.mandal_tel || r.mandal) : (r.mandal || '');
    const district = (r.district_tel || r.district) ? (r.district_tel || r.district) : (r.district || '');
    el.innerHTML = `
      <div><strong>‡∞ó‡±ç‡∞∞‡∞æ‡∞Æ‡∞Ç:</strong> ${v_tel || '‡∞Æ‡±Å‡∞§‡±ç‡∞Ø‡∞æ‡∞≤‡∞≤‡±ã‡∞™‡±Å'}</div>
      <div><strong>‡∞Æ‡∞Ç‡∞°‡∞≤‡∞Ç:</strong> ${mandal || '‚Äî'}</div>
      <div><strong>‡∞ú‡∞ø‡∞≤‡±ç‡∞≤‡∞æ:</strong> ${district || '‚Äî'}</div>
      <div><strong>‡∞∏‡∞Ç‡∞ñ‡±ç‡∞Ø‡∞≤‡±Å:</strong> ‡∞ú‡∞®‡∞æ‡∞≠‡∞æ ‡∞Æ‡±ä‡∞§‡±ç‡∞§‡∞Ç ${r.pop_total||r.population||'‚Äî'} (‡∞™‡±Å‡∞∞‡±Å‡∞∑‡±Å‡∞≤‡±Å ${r.pop_male||'‚Äî'}, ‡∞Æ‡∞π‡∞ø‡∞≥‡∞≤‡±Å ${r.pop_female||'‚Äî'})</div>
      <div><strong>‡∞á‡∞≥‡±ç‡∞≥ ‡∞∏‡∞Ç‡∞ñ‡±ç‡∞Ø:</strong> ${r.total_houses||'‚Äî'}</div>
      <div><strong>‡∞™‡±ç‡∞∞‡∞ß‡∞æ‡∞® ‡∞ï‡∞æ‡∞∞‡±ç‡∞Ø‡∞ï‡∞≤‡∞æ‡∞™‡∞æ‡∞≤‡±Å:</strong> ${r.main_occupations||'‚Äî'}</div>
    `;
  }catch(e){
    el.innerHTML = '<div class="muted telugu tiny">‡∞ó‡±ç‡∞∞‡∞æ‡∞Æ ‡∞∏‡∞Æ‡∞æ‡∞ö‡∞æ‡∞∞‡∞Ç ‡∞Ö‡∞Ç‡∞¶‡±Å‡∞¨‡∞æ‡∞ü‡±Å‡∞≤‡±ã ‡∞≤‡±á‡∞¶‡±Å.</div>';
  }
}

/* Water & Helpline (Telugu labels mapping) */
const waterMap = { 'water_supply_schedule':'‡∞®‡±Ä‡∞ü‡∞ø ‡∞∏‡∞∞‡∞´‡∞∞‡∞æ ‡∞∑‡±Ü‡∞°‡±ç‡∞Ø‡±Ç‡∞≤‡±ç', 'bore':'‡∞¨‡±ã‡∞∞‡±Å', 'bores':'‡∞¨‡±ã‡∞∞‡±ç‡∞≤‡±Å', 'electricity_line':'‡∞µ‡∞ø‡∞¶‡±ç‡∞Ø‡±Å‡∞§‡±ç ‡∞≤‡±à‡∞®‡±ç / ‡∞∏‡∞¨‡±ç ‡∞∏‡±ç‡∞ü‡±á‡∞∑‡∞®‡±ç' };
function translateWaterKey(k){ if(!k) return k; k=k.toLowerCase(); for(const key in waterMap){ if(k.includes(key)) return waterMap[key]; } return k.replace(/_/g,' '); }

async function renderWater(){
  const el = document.getElementById('waterContent');
  try{
    const rows = await loadCSV('Data/water_elec.csv');
    if(!rows || !rows.length) throw 'no';
    let html = '';
    rows.forEach(r=>{
      if(r.type && r.detail){
        html += `<div><strong>${translateWaterKey(r.type)}:</strong> ${r.detail||'‚Äî'}</div>`;
      } else {
        for(const k in r){ if(!r[k]) continue; html += `<div><strong>${translateWaterKey(k)}:</strong> ${r[k]}</div>`; }
      }
    });
    el.innerHTML = html;
  }catch(e){
    el.innerHTML = '<div class="muted telugu tiny">‡∞®‡±Ä‡∞ü‡∞ø/‡∞µ‡∞ø‡∞¶‡±ç‡∞Ø‡±Å‡∞§‡±ç ‡∞∏‡∞Æ‡∞æ‡∞ö‡∞æ‡∞∞‡∞Ç ‡∞Ö‡∞Ç‡∞¶‡±Å‡∞¨‡∞æ‡∞ü‡±Å‡∞≤‡±ã ‡∞≤‡±á‡∞¶‡±Å.</div>';
  }
}

async function renderHelpline(){
  const el = document.getElementById('helplineContent');
  try{
    const rows = await loadCSV('Data/helpline.csv');
    if(!rows || !rows.length) throw 'no';
    let html = '<ul class="list-disc pl-5 telugu tiny">';
    rows.forEach(r=> { html += `<li><strong>${r.role_tel || r.role || r.name || '‚Äî'}:</strong> <a class="link" href="tel:${r.phone || r.contact || ''}">${r.phone||r.contact||'‚Äî'}</a></li>`; });
    html += '</ul>';
    el.innerHTML = html;
  }catch(e){
    el.innerHTML = '<div class="muted telugu tiny">‡∞π‡±Ü‡∞≤‡±ç‡∞™‡±ç‚Äå‡∞≤‡±à‡∞®‡±ç ‡∞∏‡∞Æ‡∞æ‡∞ö‡∞æ‡∞∞‡∞Ç ‡∞Ö‡∞Ç‡∞¶‡±Å‡∞¨‡∞æ‡∞ü‡±Å‡∞≤‡±ã ‡∞≤‡±á‡∞¶‡±Å.</div>';
  }
}

/* Init */
renderFlash(); renderBasicInfo(); renderWater(); renderHelpline();

</script>
</body>
</html>
